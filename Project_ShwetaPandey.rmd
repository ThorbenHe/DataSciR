---
title: "Data Science with R:Project"
author: "Shweta"
date: "5/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = 'C:/Users/Dell/Desktop/SoSe21/DSwithR/Project/D')
# install.packages("janitor")
# install.packages("psych")
# install.packages("ggthemes")
library(psych)
library(tidyverse)
library(ggthemes)
library(dplyr)
library(extrafont)
library(RColorBrewer)
library(plotly)
library(tidymodels)
```


## Load data

```{r read-dataset, echo=FALSE}
# forest cover of continents dataset
forest_continents <- read_csv("FAOSTAT_data_continents.csv")

# change column names
colnames(forest_continents)[colnames(forest_continents) == "Value"] <- "ForestSize"
colnames(forest_continents)[colnames(forest_continents) == "Area"] <- "Continent"

forest_continents

```

## structure and dimension of the dataset

```{r structure-and-dimension-of-data, echo=FALSE}
str(forest_continents)
dim(forest_continents)
```



## DATA WRANGLING
```{r data-wrangling, echo=FALSE}
newData <- forest_continents %>%
  drop_na() %>% 
  select(c("Continent","Year","ForestSize")) %>% 
  group_by(Continent, Year) %>% 
  arrange(Year) %>% 
  mutate(AvgforestSize = mean(ForestSize))

newData

```


## EXPLORATORY DATA ANALYSIS

+ Plot showing the forest cover of the continents
+ the plot shows that the forest cover of the continents has decreased in the last 30 years
```{r line-plot, echo=FALSE}
newData %>% 
  ggplot(aes(x = Year, y = AvgforestSize,color = Continent))+
  geom_line(size = 1.5, alpha = 0.7)+
  labs(title = "Average Forest Size of continents (1990-2020)",
       subtitle = "How the forest size (avg) has changed over the last 30 years?",
       x = "Year",
       y = "Average Forest Size (ha)",
       color = "Continent")+
  theme_fivethirtyeight()+
  theme(axis.title = element_text(),text = element_text(family = "Arial"))+
  theme(plot.subtitle = element_text(size = rel(0.8), face = "italic"))+ 
  scale_color_brewer(palette = "Dark2")
```



```{r forest-continents-scatter-plot, echo=FALSE}
newData  %>% 
  ggplot(aes(x = Year, y = ForestSize)) +
  geom_point(aes(color = Continent), size = 4, shape = 16, alpha = 0.7) +
  scale_y_continuous(limits = c(100000, 1800000))+
  labs(
    x = "Years",
    y = "Forest land(1000ha)",
    title = "World forest land through the decades"
  ) +
  theme_minimal()
  # scale_color_gradient(low = "#0091ff", high = "#f0650e")


```


## Load Country data
```{r qwerty2, echo=FALSE}
forest_countries <- read_csv("FAOSTAT_data_6-9-2021.csv")

colnames(forest_countries)[colnames(forest_countries) == "Value"] <- "ForestArea"
colnames(forest_countries)[colnames(forest_countries) == "Area"] <- "Country"
forest_countries <- forest_countries %>% subset(Country != "USSR")

glimpse(forest_countries)
```


## TOP 20 COUNTRIES WITH LARGEST FOREST AREA

+ Russian fedration has the largest forest cover in the last 30 years
```{r top-20-countries-with-largest-forest-area-plot, echo=FALSE}

forest_countries %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avg_forest_size = mean(ForestArea)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avg_forest_size)) %>%
  top_n(20) %>% 
  ggplot(aes(x = avg_forest_size, y = reorder(Country, avg_forest_size))) +
  geom_col(fill = "#1c9099") +
  theme(legend.position = "none") +
  labs(
    x = "Average Forest Size (ha)",
    y = "Country",
    title = "Top 10 countries with largest forest area",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial")) 
 
```




```{r qwerty3, echo=FALSE}
forest_countries %>%
  drop_na() %>%
  group_by(Country, Year) %>% 
  summarize(forest_perYear = sum(ForestArea)/Year)#### do this with air pollution per year

```


## COUNTRIES WITH LEAST FOREST AREA
+ Curacao has show the least forest cover in the last 30 years

```{r countries-with-least-forest-area-plot, echo=FALSE}

forest_countries %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avg_forest_size = mean(ForestArea)) %>% 
  as.data.frame() %>% 
  arrange(desc(avg_forest_size)) %>%
  top_n(-20) %>% 
  ggplot(aes(x = avg_forest_size, y = reorder(Country, avg_forest_size), fill = Country)) +
  geom_col(fill = "#756bb1") +
  theme(legend.position = "none") +
  labs(
    x = "Average Forest Size (ha)",
    y = "Countries",
    title = "Countries with least forest area",
    subtitle = "Time period: 1990 - 2020"
  )+
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial"))
  
```

## FOREST DATA OVER THE YEARS
```{r maximum-forest-cover-plot, echo=FALSE}
forest_countries %>% 
  drop_na() %>% 
  group_by(Year) %>%
  summarize(max_forest_size = max(ForestArea)) %>% 
  as.data.frame() %>% 
  ggplot(aes(x = Year, y =max_forest_size , fill = max_forest_size)) + 
  geom_col()+
  labs(
    x = "Year",
    y = "Forest Size (ha)",
    title = "Maximum Forest cover over the last 30 years"
  ) +
  scale_x_continuous(breaks = seq(1990,2020,10)) +
  scale_y_continuous(labels = scales::comma)
```
#####################################################################################################################

## LOAD SECOND DATASET
```{r air-pollution-data, echo=FALSE}

AirPollution <- read_csv("EXP_PM2_Air_Quality.csv")
colnames(AirPollution)[colnames(AirPollution) == "Value"] <- "AirQuality"
glimpse(AirPollution)

AirPollution <- AirPollution %>% 
  select(c("Country", "Year","AirQuality")) %>% 
  group_by(Country,Year) %>% 
  glimpse()

```

## MERGE TWO DATASETS
```{r merged-data-set, echo=FALSE}
mergedData <- merge(forest_countries, AirPollution, by=c("Country","Year")) %>%
  select(c('Country','Year','ForestArea','AirQuality')) %>% 
  drop_na() %>% 
  group_by(Year) %>% 
  summarize(TotalForestArea = sum(ForestArea), TotalAirQuality = sum(AirQuality)) %>% 
  ungroup() %>% 
  unique()
mergedData

```


```{r correlation-plots, echo=FALSE}
mergedData %>% 
  ggplot(aes(x = TotalForestArea, y = TotalAirQuality)) +
  geom_point() +
  labs(x="Total Forest Area (ha)", y = "Total Air Quality", title="Correaltion between Forest Area and Air Quality (globally)") + 
  geom_smooth(method = 'lm')


```

## CORRELATION
```{r correlation, echo=FALSE}
cor(x =mergedData$TotalForestArea, y = mergedData$TotalAirQuality, use = "everything", method = "kendall")

```


## Load temperature change data

```{r temperature-change-data, echo=FALSE}

temp_change <- read_csv("FAOSTAT_data_temp_change.csv")
glimpse(temp_change)

colnames(temp_change)[colnames(temp_change) == "Value"] <- "TemperatureChange"
colnames(temp_change)[colnames(temp_change) == "Area"] <- "Country"

temp_change <- temp_change %>% 
  drop_na() %>% 
  group_by(Country,Months) %>% 
  select(c("Country", "Year", "Months","TemperatureChange")) %>% 
  glimpse()

```


## REGRESSION ANALYSIS

```{r regression, echo=FALSE}
# merge  data sets and remove missing values

data1 <-  merge(forest_countries,AirPollution,by=c("Country","Year")) %>%
  drop_na() %>% 
  select(c("Country","Year","ForestArea","AirQuality"))


data <- merge(data1, temp_change, by=c("Year","Country")) %>% 
  select(c("Country","Year","TemperatureChange","ForestArea","AirQuality")) %>% 
  glimpse()
 
```

## fit model and estimate parameters

```{r build-model, echo=FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirQuality + TemperatureChange, data = data) -> model
model

linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirQuality + TemperatureChange,data = data) %>% glance()
```


## extrapolation
```{r tidy, echo=FALSE}
fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirQuality + TemperatureChange, data = data) 

fit %>% tidy()
```

## RESIDUAL

```{r residual-plot-Air-Pollution, echo=FALSE}
augment(fit$fit) %>%
  ggplot(aes(x = ForestArea, y = AirQuality)) +
  geom_point(aes(color=.resid)) +
  geom_smooth(method = "lm") +
  scale_color_gradient2(mid = "gray80") +
  labs(x = "ForestArea", y = "AirPollution", color = "Residuals") +
  scale_y_continuous(labels = scales::comma)
```

## residual- Temperature Change
```{r qwerty6, echo=FALSE}
augment(fit$fit) %>%
  ggplot(aes(x = ForestArea, y = TemperatureChange)) +
  geom_point(aes(color=.resid)) +
  geom_smooth(method = "lm") +
  scale_color_gradient2(mid = "gray80") +
  labs(x = "ForestArea", y = "Temparture Change", color = "Residuals") +
  scale_y_continuous(labels = scales::comma)
```







## Top 10 countries with worst air quality
```{r Air-Pollution-plot, echo=FALSE}
AirPollution %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avgAirQuality = mean(AirQuality)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avgAirQuality)) %>%
  top_n(10) %>% 
  ggplot(aes(y = avgAirQuality, x = reorder(Country, avgAirQuality))) +
  geom_col(fill = "#869c19") +
  theme(legend.position = "none") +
  labs(
    x = "Average Air Quality",
    y = "Country",
    title = "Top 10 countries with worst air quality ",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black" ), text = element_text(family="Arial")) 
  

```




Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
