---
title: "Data Science with R: Project"
author: "Shweta"
date: "5/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = 'C:/Users/Dell/Desktop/SoSe21/DSwithR/Project/D')

library(psych)
library(tidyverse)
library(ggthemes)
library(dplyr)
library(extrafont)
library(RColorBrewer)
library(plotly)
library(tidymodels)

options(scipen=999)
```


### This part of our project answers the following questions:

* What was the global forest development over the last 30 years? 
  + What are the trends? (globally)
* Is there a correlation between air pollution and the amount of forest in a country / globally?
  + Which countries have the most air pollution?
  
### Overview and preprocessing of the available data

The first data set is about the forest cover of the continents.
[Forest land of continents](http://www.fao.org/faostat/en/#data/GF)


First we preprocess the data set, we change the names of te columns we later need and make them more readable

* The 'Value' column has been change to ForestSize to make it more understandable
* The 'Area' column has been renamed as Continent to give more meaningful information 


```{r read-dataset, echo=FALSE}
# forest cover of continents dataset
forest_continents <- read_csv("FAOSTAT_data_continents.csv")

# change column names
colnames(forest_continents)[colnames(forest_continents) == "Value"] <- "ForestSize"
colnames(forest_continents)[colnames(forest_continents) == "Area"] <- "Continent"

forest_continents

```


```{r structure-and-dimension-of-data, echo=FALSE}
str(forest_continents)
dim(forest_continents)
```
Here we have pre-processed out data set

* We have imputed the missing values by dropping them 

```{r data-wrangling, echo=FALSE}
newData <- forest_continents %>%
  drop_na() %>% 
  select(c("Continent","Year","ForestSize")) %>% 
  group_by(Continent, Year) %>% 
  arrange(Year) %>% 
  mutate(AvgforestSize = mean(ForestSize))

newData

```



## Global Forest Trend

+ Plot showing the forest cover of the continents
+ the plot shows that the forest cover of the continents has decreased in the last 30 years


```{r forest-continents-scatter-plot, echo=FALSE}
newData  %>% 
  ggplot(aes(x = Year, y = ForestSize)) +
  geom_point(aes(color = Continent), size = 3, shape = 16, alpha = 0.7) +
  scale_y_continuous(limits = c(100000, 1800000))+
  labs(
    x = "Years",
    y = "Forest land(1000ha)",
    title = "Global Forest Land through the decades"
  ) +
  theme_minimal()+
  scale_y_continuous(labels = scales::comma)

```
### Findings:
+ Forest land has decreased globally


```{r Load-Country-data, echo=FALSE}
forest_countries <- read_csv("FAOSTAT_data_6-9-2021.csv")

colnames(forest_countries)[colnames(forest_countries) == "Value"] <- "ForestArea"
colnames(forest_countries)[colnames(forest_countries) == "Area"] <- "Country"
forest_countries <- forest_countries %>% subset(Country != "USSR")
forest_countries <- forest_countries %>% subset(Country != "China, mainland")

glimpse(forest_countries)
```


## Top 20 countries with largest forest area


```{r top-20-countries-with-largest-forest-area-plot, echo=FALSE}

forest_countries %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avg_forest_size = mean(ForestArea)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avg_forest_size)) %>%
  top_n(20) %>% 
  ggplot(aes(x = avg_forest_size, y = reorder(Country, avg_forest_size))) +
  geom_col(fill = "#1c9099") +
  theme(legend.position = "none") +
  labs(
    x = "Average Forest Size (1000ha)",
    y = "Country",
    title = "Top 10 countries with largest forest area",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial")) 
 
```
### Findings
+ Russian federation has the largest forest cover in the last 30 years



```{r preprocessing-country-data, echo=FALSE}
forest_countries %>%
  drop_na() %>%
  group_by(Country, Year) %>% 
  summarize(forest_perYear = sum(ForestArea)/Year)#### do this with air pollution per year

```


## Countries With least forest area


```{r countries-with-least-forest-area-plot, echo=FALSE}

forest_countries %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avg_forest_size = mean(ForestArea)) %>% 
  as.data.frame() %>% 
  arrange(desc(avg_forest_size)) %>%
  top_n(-20) %>% 
  ggplot(aes(x = avg_forest_size, y = reorder(Country, -avg_forest_size), fill = Country)) +
  geom_col(fill = "#756bb1") +
  theme(legend.position = "none") +
  labs(
    x = "Average Forest Size (1000ha)",
    y = "Country",
    title = "Countries with least forest area",
    subtitle = "Time period: 1990 - 2020"
  )+
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial"))
  
```
### Findings
+ Curacao has show the least forest cover in the last 30 years



The air pollution data has air quality value in microgram cubic metre from the year 1990 to 2019. However, a few years \n data is not available.
Air quality shows changes in the amount of pollution in the air. 

```{r air-pollution-data, echo=FALSE}

AirPollution <- read_csv("EXP_PM2_Air_Quality.csv")
colnames(AirPollution)[colnames(AirPollution) == "Value"] <- "AirPollution"
glimpse(AirPollution)

AirPollution <- AirPollution %>% 
  select(c("Country", "Year","AirPollution")) %>% 
  group_by(Country,Year) %>% 
  glimpse()

```

```{r merged-data-set, echo=FALSE}
mergedData <- merge(forest_countries, AirPollution, by=c("Country","Year")) %>%
  select(c('Country','Year','ForestArea','AirPollution')) %>% 
  drop_na() %>% 
  group_by(Year) %>% 
  summarize(TotalForestArea = sum(ForestArea), TotalAirPollution = sum(AirPollution)) %>% 
  ungroup() %>% 
  unique()
mergedData

```
## Is there a correlation between Forest area and air pollution?

```{r correlation-plots, echo=FALSE}
mergedData %>% 
  ggplot(aes(x = TotalForestArea, y = TotalAirPollution)) +
  geom_point(size = 4, alpha=0.7, color = "#056b5f") +
  geom_line(size=1, alpha=0.5, color="#056b5f")+
  labs(x="Total Forest Area (1000ha)", y = "Total Air Pollution", title="Correlation between Forest Area and Air Pollution (globally)") + 
  geom_smooth(method = 'lm')+
  scale_x_continuous(labels = scales::comma)+
  scale_y_continuous(labels = scales::comma)
```
Findings:
No linear relationship between Forest Area and Air Pollution



## Correlation Value
```{r correlation, echo=FALSE}
corr <- cor(x = mergedData$TotalForestArea, y = mergedData$TotalAirPollution, use = "everything", method = "kendall")
paste("Kendall = ", corr)

```
Findings:
A negative correlation coefficient shows the variables are moving in the opposite direction.

## Regression Analysis

```{r regression, echo=FALSE}
# merge  data sets and remove missing values

data <-  merge(forest_countries,AirPollution,by=c("Country","Year")) %>%
  drop_na() %>% 
  select(c("Country","Year","ForestArea","AirPollution"))
 
```

## fit model and estimate parameters

```{r build-model, echo=FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirPollution, data = data) -> model
model

```
Findings:


## extrapolation
```{r tidy, echo=FALSE}
fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirPollution, data = data) 

fit %>% tidy()
```
Findings:
Very low p-value signifies that Forest Area and Air Pollution are independent of each other.

## Residual Plot

```{r residual-plot-Air-Pollution, echo=FALSE}
augment(fit$fit) %>%
  ggplot(aes(x = ForestArea, y = AirPollution)) +
  geom_point(aes(color=.resid)) +
  geom_smooth(method = "lm") +
  scale_color_gradient2(mid = "gray80") +
  labs(title = "Residual",
       x = "Forest Area (1000ha)", 
       y = "AirPollution(Micrograms per cubic metre)", color = "Residuals") +
  scale_y_continuous(labels = scales::comma)
```
Finding:

* As our data set is non-linearly associated, the residual plot here assesses the appropriateness of our linear regression

* In the plot the residual of data points are away from zero show the model is not a good fit



### For more reliable results of the relationship between Forest Area and Air Pollution,\n
we implement Predictive Power Score

```{r air-pollution, echo=FALSE}

library(ppsr)
pps1 <- score_df(data %>% 
                   group_by(Year) %>% 
                   summarise(AirPollution = sum(AirPollution, na.rm = TRUE), 
                             ForestArea = sum(ForestArea)) %>% ungroup() %>% 
                   select(AirPollution, ForestArea))
ggplot(pps1, aes(x, y)) +
  geom_tile(aes(fill = pps)) +
  geom_text(aes(label = round(pps, 2), color = pps > 0.8), size = 12 / .pt) +
  scale_fill_distiller(palette = "Green", direction = 1) +
  scale_color_manual(values = c("black", "white")) +
  guides(color = FALSE) +
  labs(
    x = NULL, y = NULL, fill = "Predictive\nPower\nScore", title = "PPS matrix for relation between global forest area\n and air quality ",
    subtitle = "A value represents the predictive power that the\nx variable has on the y variable."
  ) +
  coord_equal() +
  theme(axis.text.x = element_text(angle = 325, hjust = 0, vjust = 0)) +
  theme(plot.subtitle = element_text(size = rel(1))) + 
  theme_minimal()

```
Findings:

Predictive Power Score of 0 shows no relationship between Forest Area and Air Pollution

## Top 10 countries with most air pollution
```{r Air-Pollution-plot, echo=FALSE}
AirPollution %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avgAirPollution = mean(AirPollution)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avgAirPollution)) %>%
  top_n(10) %>% 
  ggplot(aes(x = avgAirPollution, y = reorder(Country, avgAirPollution))) +
  geom_col(fill = "#DE8971", width = 0.5) +
  theme(legend.position = "none") +
  labs(
    x = "Average Air Pollution (Micrograms per cubic metre)",
    y = "Country",
    title = "Top 10 countries with highest air pollution ",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black" ), text = element_text(family="Arial"))
```
Findings:

India has the highest air pollution in the last 30 years 


## Least air pollution

```{r Air-Pollution-plot-least, echo=FALSE}
AirPollution %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avgAirPollution = mean(AirPollution)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avgAirPollution)) %>%
  top_n(-10) %>% 
  ggplot(aes(x = avgAirPollution, y = reorder(Country, -avgAirPollution))) +
  geom_col(fill = "#70AF85", width = 0.6) +
  theme(legend.position = "none") +
  labs(
    x = "Average Air Pollution (Micrograms per cubic metre)",
    y = "Country",
    title = "Top 10 countries with least air pollution",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black" ), text = element_text(family="Arial"))
  

```
Finding:
Nauru has the least air pollution in the last 30 years.


### Air pollution trend in India
```{r India-plot, echo=FALSE}

AirPollution_India <- AirPollution %>% 
  group_by(Year) %>% 
  filter(Country == "India") %>% 
  summarize(AirPollution = mean(AirPollution)) %>% 
  ungroup() 
  


AirPollution_India %>% 
  ggplot(aes(x = Year, y = AirPollution))+
  geom_point(color =  "#79198a", size = 5, alpha = 0.6)+
  geom_line(size = 1.3, alpha = 0.6)+
  labs(title = "Air Pollution in India through decades",
       subtitle = "Time period: 1990-2019",
       x = "Year",
       y = "Average Air Pollution (Micrograms per cubic metre)")+
  theme_fivethirtyeight()+
  theme(axis.title = element_text(),text = element_text(family = "Arial"))+
  theme(plot.subtitle = element_text(size = rel(0.8)))
```
Findings:
* Air Pollution drastically increased after the year 2005.
* It was highest in 2012.
* It decreased in 2005 by ~10 Micrograms per cubic metre.
* Sudden decrease around 2017.
* Increased slightly in 2019 again


### Air pollution trend in Nauru
```{r nauru-plot, echo=FALSE}

AirPollution_Nauru <- AirPollution %>% 
  group_by(Year) %>% 
  filter(Country == "Nauru") %>% 
  summarize(AirPollution = mean(AirPollution)) %>% 
  ungroup() 

AirPollution_Nauru %>% 
  ggplot(aes(x = Year, y = AirPollution))+
  geom_point(color =  "#53ab0f", size = 5, alpha = 0.6)+
  geom_line(size = 1.3, alpha = 0.6)+
  labs(title = "Air Pollution in Nauru through decades",
       subtitle = "Time period: 1990-2019",
       x = "Year",
       y = "Average Air Pollution (Micrograms per cubic metre)")+
  theme_fivethirtyeight()+
  theme(axis.title = element_text(),text = element_text(family = "Arial"))+
  theme(plot.subtitle = element_text(size = rel(0.8)))
```
Findings:
* Air Pollution varies in range of 5 Micrograms per cubic metre and ~7 Micrograms per cubic metre.
* Least in 2014



