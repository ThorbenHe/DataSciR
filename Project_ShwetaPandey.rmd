---
title: "Data Science with R: Project"
author: "Shweta"
date: "5/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = 'C:/Users/Dell/Desktop/SoSe21/DSwithR/Project/D')

library(psych)
library(tidyverse)
library(ggthemes)
library(dplyr)
library(extrafont)
library(RColorBrewer)
library(plotly)
library(tidymodels)

options(scipen=999)
```


### This part of our project answers the following questions:

* What was the global forest development over the last 30 years? 
  + What are the trends? (globally)
* Is there a correlation between air pollution and the amount of forest in a country / globally?
  + Which countries have the most air pollution?
  
### Overview and preprocessing of the available data

The first data set is about the forest cover of the continents.
[Forest land of continents](http://www.fao.org/faostat/en/#data/GF)


First we preprocess the data set, we change the names of te columns we later need and make them more readable

* The 'Value' column has been change to ForestSize to make it more understandable
* The 'Area' column has been renamed as Continent to give more meaningful information 


```{r read-dataset, echo=FALSE}
# forest cover of continents dataset
forest_continents <- read_csv("FAOSTAT_data_continents.csv")

# change column names
colnames(forest_continents)[colnames(forest_continents) == "Value"] <- "ForestSize"
colnames(forest_continents)[colnames(forest_continents) == "Area"] <- "Continent"

forest_continents

```


```{r structure-and-dimension-of-data, echo=FALSE}
str(forest_continents)
dim(forest_continents)
```
Here we have pre-processed out data set

* We have imputed the missing values by dropping them 

```{r data-wrangling, echo=FALSE}
newData <- forest_continents %>%
  drop_na() %>% 
  select(c("Continent","Year","ForestSize")) %>% 
  group_by(Continent, Year) %>% 
  arrange(Year) %>% 
  mutate(AvgforestSize = mean(ForestSize))

newData

```



## EXPLORATORY DATA ANALYSIS

+ Plot showing the forest cover of the continents
+ the plot shows that the forest cover of the continents has decreased in the last 30 years


```{r forest-continents-scatter-plot, echo=FALSE}
newData  %>% 
  ggplot(aes(x = Year, y = ForestSize)) +
  geom_point(aes(color = Continent), size = 3, shape = 16, alpha = 0.7) +
  scale_y_continuous(limits = c(100000, 1800000))+
  labs(
    x = "Years",
    y = "Forest land(1000ha)",
    title = "World forest land through the decades"
  ) +
  theme_gray()
  # scale_color_gradient(low = "#0091ff", high = "#f0650e")


```


## Load Country data
```{r qwerty2, echo=FALSE}
forest_countries <- read_csv("FAOSTAT_data_6-9-2021.csv")

colnames(forest_countries)[colnames(forest_countries) == "Value"] <- "ForestArea"
colnames(forest_countries)[colnames(forest_countries) == "Area"] <- "Country"
forest_countries <- forest_countries %>% subset(Country != "USSR")

glimpse(forest_countries)
```


## TOP 20 COUNTRIES WITH LARGEST FOREST AREA

+ Russian fedration has the largest forest cover in the last 30 years
```{r top-20-countries-with-largest-forest-area-plot, echo=FALSE}

forest_countries %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avg_forest_size = mean(ForestArea)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avg_forest_size)) %>%
  top_n(20) %>% 
  ggplot(aes(x = avg_forest_size, y = reorder(Country, avg_forest_size))) +
  geom_col(fill = "#1c9099") +
  theme(legend.position = "none") +
  labs(
    x = "Average Forest Size (ha)",
    y = "Country",
    title = "Top 10 countries with largest forest area",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial")) 
 
```




```{r qwerty3, echo=FALSE}
forest_countries %>%
  drop_na() %>%
  group_by(Country, Year) %>% 
  summarize(forest_perYear = sum(ForestArea)/Year)#### do this with air pollution per year

```


## COUNTRIES WITH LEAST FOREST AREA
+ Curacao has show the least forest cover in the last 30 years

```{r countries-with-least-forest-area-plot, echo=FALSE}

forest_countries %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avg_forest_size = mean(ForestArea)) %>% 
  as.data.frame() %>% 
  arrange(desc(avg_forest_size)) %>%
  top_n(-20) %>% 
  ggplot(aes(x = avg_forest_size, y = reorder(Country, avg_forest_size), fill = Country)) +
  geom_col(fill = "#756bb1") +
  theme(legend.position = "none") +
  labs(
    x = "Average Forest Size (ha)",
    y = "Countries",
    title = "Countries with least forest area",
    subtitle = "Time period: 1990 - 2020"
  )+
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial"))
  
```


## LOAD SECOND DATASET
```{r air-pollution-data, echo=FALSE}

AirPollution <- read_csv("EXP_PM2_Air_Quality.csv")
colnames(AirPollution)[colnames(AirPollution) == "Value"] <- "AirQuality"
glimpse(AirPollution)

AirPollution <- AirPollution %>% 
  select(c("Country", "Year","AirQuality")) %>% 
  group_by(Country,Year) %>% 
  glimpse()

```

## MERGE TWO DATASETS
```{r merged-data-set, echo=FALSE}
mergedData <- merge(forest_countries, AirPollution, by=c("Country","Year")) %>%
  select(c('Country','Year','ForestArea','AirQuality')) %>% 
  drop_na() %>% 
  group_by(Year) %>% 
  summarize(TotalForestArea = sum(ForestArea), TotalAirQuality = sum(AirQuality)) %>% 
  ungroup() %>% 
  unique()
mergedData

```


```{r correlation-plots, echo=FALSE}
mergedData %>% 
  ggplot(aes(x = TotalForestArea, y = TotalAirQuality)) +
  geom_point() +
  labs(x="Total Forest Area (ha)", y = "Total Air Quality", title="Correaltion between Forest Area and Air Quality (globally)") + 
  geom_smooth(method = 'lm')


```

## CORRELATION
```{r correlation, echo=FALSE}
cor(x =mergedData$TotalForestArea, y = mergedData$TotalAirQuality, use = "everything", method = "kendall")

```


## REGRESSION ANALYSIS

```{r regression, echo=FALSE}
# merge  data sets and remove missing values

data <-  merge(forest_countries,AirPollution,by=c("Country","Year")) %>%
  drop_na() %>% 
  select(c("Country","Year","ForestArea","AirQuality"))
 
```

## fit model and estimate parameters

```{r build-model, echo=FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirQuality, data = data) -> model
model

linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirQuality, data = data) %>% glance()
```


## extrapolation
```{r tidy, echo=FALSE}
fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(formula = ForestArea ~ AirQuality, data = data) 

fit %>% tidy()
```

## RESIDUAL

```{r residual-plot-Air-Pollution, echo=FALSE}
augment(fit$fit) %>%
  ggplot(aes(x = ForestArea, y = AirQuality)) +
  geom_point(aes(color=.resid)) +
  geom_smooth(method = "lm") +
  scale_color_gradient2(mid = "gray80") +
  labs(x = "Forest Area", y = "AirPollution", color = "Residuals") +
  scale_y_continuous(labels = scales::comma)
```



```{r Global-Air-Quality-plot, echo=FALSE}

AirPollution %>% 
  group_by(Country,Year) %>% 
  summarise(AirQuality = mean(AirQuality)) %>% 
  ungroup() %>% 
  ggplot(aes(x = Year, y = AirQuality, color = AirQuality))+
  geom_point()+
  colorspace::scale_color_continuous_sequential("Magenta")+
  theme_gray()

```


## Top 10 countries with worst air quality
```{r Air-Pollution-plot, echo=FALSE}
AirPollution %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avgAirQuality = mean(AirQuality)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avgAirQuality)) %>%
  top_n(10) %>% 
  ggplot(aes(x = avgAirQuality, y = reorder(Country, avgAirQuality))) +
  geom_col(fill = "#DE8971", width = 0.5) +
  theme(legend.position = "none") +
  labs(
    x = "Country",
    y = "Average Air Quality",
    title = "Top 10 countries with worst air quality ",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_excel_new()+
  theme(axis.title.x = element_text(color = "Black" ), text = element_text(family="Arial"))
```
## best air quality

```{r Air-Pollution-plot-least, echo=FALSE}
AirPollution %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avgAirQuality = mean(AirQuality)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avgAirQuality)) %>%
  top_n(-10) %>% 
  ggplot(aes(x = avgAirQuality, y = reorder(Country, avgAirQuality))) +
  geom_col(fill = "#70AF85", width = 0.6) +
  theme(legend.position = "none") +
  labs(
    x = "Average Air Quality",
    y = "Country",
    title = "Top 10 countries with worst air quality ",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_excel_new()+
  theme(axis.title.x = element_text(color = "Black" ), text = element_text(family="Arial"))
  

```




```{r India-plot, echo=FALSE}

AirQuality_India <- AirPollution %>% 
  group_by(Year) %>% 
  filter(Country == "India") %>% 
  summarize(AirQuality = mean(AirQuality)) %>% 
  ungroup() 
  


AirQuality_India %>% 
  ggplot(aes(x = Year, y = AirQuality))+
  geom_point(color =  "#79198a", size = 5, alpha = 0.6)+
  geom_line(size = 1.3, alpha = 0.6)+
  labs(title = "Air Quality of India",
       subtitle = "Time period: 1990-2019",
       x = "Year",
       y = "Air Quality (Micrograms per cubic metre)")+
  theme_fivethirtyeight()+
  theme(axis.title = element_text(),text = element_text(family = "Arial"))+
  theme(plot.subtitle = element_text(size = rel(0.8), face = "italic"))
```

```{r nauru-plot, echo=FALSE}

AirQuality_Nauru <- AirPollution %>% 
  group_by(Year) %>% 
  filter(Country == "Nauru") %>% 
  summarize(AirQuality = mean(AirQuality)) %>% 
  ungroup() 

AirQuality_Nauru %>% 
  ggplot(aes(x = Year, y = AirQuality))+
  geom_point(color =  "#53ab0f", size = 5, alpha = 0.6)+
  geom_line(size = 1.3, alpha = 0.6)+
  labs(title = "Air Quality of Nauru through the years",
       subtitle = "Time period: 1990-2019",
       x = "Year",
       y = "Air Quality (Micrograms per cubic metre)")+
  theme_fivethirtyeight()+
  theme(axis.title = element_text(),text = element_text(family = "Arial"))+
  theme(plot.subtitle = element_text(size = rel(0.8), face = "italic"))
```







Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
