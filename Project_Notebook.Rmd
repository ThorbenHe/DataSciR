---
title: |
  ![](./data/forest.jpg){width=850px height=180px style="object-fit: cover;"}  
  <br />
  Multi-Perspective and Predictive Analysis of Forests; the Issues, Challenges and Global Trends  
subtitle: "Project Notebook"
author: "Kiran Babu Thatha, Marcel Schulte, Obinna Patrick Nkwocha, Shweta Pandey, Thorben Hebbelmann"
date: "`r Sys.Date()`"
bibliography: refs.bib
output: 
  prettydoc::html_pretty:
    theme: cayman    
    toc: true
    #toc_float: true
    number_sections: true
    df_print: paged
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
#chooseCRANmirror(graphics=FALSE, ind=1)
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, fig.align = "center", dpi = 300, rows.print = 5, cols.min.print = 5)

library(psych)
library(tidyverse)
library(ggthemes)
library(dplyr)
library(extrafont)
library(RColorBrewer)
library(plotly)
library(tidymodels)
library(countrycode)
library(kableExtra)
library(ppsr)
library(patchwork)
library(gganimate)
library(mice)
library(stringr)
library(rworldmap)
library(data.table)
library(gifski)
library(htmltools)
library(naniar)



#set theme
theme_set(theme_minimal())

options(scipen=999)
```

# Overview & Motivation

The existence of forests is essential for our life on Earth. By covering around 31 percent of the world’s total land area, forests provide a retreat and home to over 80 percent of land animals and countless partially even undiscovered plants. One can say that forests are the backbone of entire ecosystems. A significant part of the oxygen we breathe is provided by the trees, while they also absorb about 25 percent of greenhouse gases. Also economically we are dependent on forests as the livelihoods of about 1.6 billion people around the world are directly or indirectly connected to forests. Furthermore, forests provide 40 percent of today’s global renewable energy supply, as much as solar, hydroelectric and wind power combined.
Despite these utilities, forestation across the world has faced several challenges ranging from wildfire, human-driven deforestation, poor management and poor conversation in general. However, a loss of whole forests would mean severe consequences to humanity and life on Earth.  

With this project we seek to answer important questions that address these challenges. We want to figure out the causes of destruction of forests, highlight their importance to our environment and predict trends around reforestation/deforestation. Moreover, we hope to show how we can tackle climate change by reforestation, in particular, how an increase in forest area will help to increase the buffer of sustainability.
For the statistics so far, see our reference [@unece2019].

# Initial Questions

To begin with we want to give a general overview of global forest development over the last 30 years. Afterwards we want to dig deeper into the topics of deforestation and reforestation by extracting the main driver countries, showing trends and investigating in possible correlations which is leading to a crucial prediction in how many years forest would be lost, if humankind continues to act as it has in the past. 
In the next chapter, our analysis leads us into the area of forest destruction by natural causes. After a comprehensive overview and focusing on countries most affected by forest destruction, we want to examine whether there is a correlation between rising temperatures and wildfires and additionally try to predict where and when wildfires are likely to occur.
In our final chapter we put our forest data in relation to other environmental issues as air pollution, greenhouse gas emissions and the carbon storage of forests resulting in a prediction of how much forest area has to be further increased to tackle all greenhouse gas emissions.

During the analysis, we considered some of our rather general questions from the proposal from different angles in order to provide answers that are more specific about different regions of the world. Furthermore we also tried to give some overview over other environmental issues related to our questions, for example which countries have the highest air pollution or emission values. 

# Related Work

Many scientists and experts have been investigating the development of our planet's forests in recent years. One has the impression that newspapers and magazines report almost daily on topics related to forests. The focus is almost always on climate change, which not only has an influence on forests [@field2014climate], but can also be influenced by the development and reforestation of forests [@messier2013managing].

Since the global forest development plays such a role when facing climate change, it is not surprising that there are large assessments about this topic. The Global Forest Resources Assessment published 2020 a report in which they deal with a large variety of aspects concerning forests, e.g. different forest types and protected areas [@fao2020forest].

Also Hannah Ritchie and Max Roser revealed on OurWorldInData.org a comprehensive report about the current status of our Earth’s forests. Especially the topic around deforestation in general and the reasons for human-driven deforestation are elaborated [@owidforestsanddeforestation].

# Datasets & Preprocessing

In the following we will give an overview over the different datasets we will use to answer our questions and also show some of the preprocessing steps we performed before the analysis.

## Global Forest Resources Assessment
The data of the Global Forest Resources assessment (FAO) is containing 3 datasets. Data on forest development for the intervals between 1990 - 2020, which we mainly use to answer questions around reforestation and deforestation, as well as data on forest disturbance for the period 2000-2017 and data on total forest areas [@fao2020fra].

**1.1 Data on forest development:**
```{r echo=FALSE, message=FALSE}
intervals <- tibble(read_csv("data/fao_fra_datasets/fra_forest_development_data.csv"))
intervals %>% drop_na() %>% select(name, year, contains('1'))
intervals %>% relocate(contains('1'))%>% vis_miss()

```
  
```{r preprocessing_kiran, echo=FALSE, message=FALSE,warning=FALSE}
Forest_Area<- tibble(read_csv("data/fao_fra_datasets/fra_forest_area_data.csv"))

intervals_1<-intervals %>% mutate(`1d_deforestation`=case_when(year %in% c("1990-2000","2000-2010")~`1d_deforestation`*10,year %in% c("2010-2015","2015-2020")~`1d_deforestation`*5)) %>% mutate(`1d_expansion`=case_when(year %in% c("1990-2000","2000-2010")~`1d_expansion`*10,year %in% c("2010-2015","2015-2020")~`1d_expansion`*5)) %>% mutate(`1d_afforestation`=case_when(year %in% c("1990-2000","2000-2010")~`1d_afforestation`*10,year %in% c("2010-2015","2015-2020")~`1d_afforestation`*5)) %>% mutate(`1e_reforestation`=case_when(year %in% c("1990-2000","2000-2010")~`1e_reforestation`*10,year %in% c("2010-2015","2015-2020")~`1e_reforestation`*5)) %>%mutate(`1d_nat_exp`=case_when(year %in% c("1990-2000","2000-2010")~`1d_nat_exp`*10,year %in% c("2010-2015","2015-2020")~`1d_nat_exp`*5)) 

intervals_2<- intervals_1%>% select(regions,name,`1d_deforestation`,`1d_expansion`,`1d_afforestation`,`1e_reforestation`,`1d_nat_exp`)  %>% group_by(name,regions) %>% summarize(t_deforestation =sum(as.numeric(`1d_deforestation`),na.rm = TRUE),t_expansion=sum(as.numeric(`1d_expansion`),na.rm = TRUE),t_afforestation =sum(as.numeric(`1d_afforestation`),na.rm = TRUE),t_reforestation =sum(as.numeric(`1e_reforestation`),na.rm = TRUE),t_nat_exp =sum(as.numeric(`1d_nat_exp`),na.rm = TRUE))

def_30<-inner_join(intervals_2,Forest_Area,by="name") %>%mutate(t_deforestation=case_when(t_deforestation==0.00  ~ `1990`-`2020`,t_deforestation>0.00 ~ t_deforestation)) %>% mutate(t_deforestation=case_when(t_deforestation<0.00  ~ 0.00,t_deforestation>=0.00 ~ t_deforestation))%>% mutate(year= as.integer((30*`2020`)/t_deforestation))


def_30<-def_30 %>% mutate(percent_change_1=(t_deforestation/`1990`)*100) %>%  mutate(drivers=case_when(percent_change_1<30 ~ "not Drivers",percent_change_1>30  ~"Main Drivers")) %>% mutate(percent_change_1=format(round(percent_change_1,2),nsmall=2))

def_30$name[def_30$name=="Bolivia (Plurinational State of)"]<-"Bolivia"
def_30$name[def_30$name=="Brunei Darussalam"]<-"Brunei"
def_30$name[def_30$name=="Cabo Verde"]<-"Cape Verde"
def_30$name[def_30$name=="Congo"]<-"Democratic Republic of the Congo"
def_30$name[def_30$name=="Côte d'Ivoire"]<-"Ivory Coast"
def_30$name[def_30$name=="French Guyana"]<-"French Guiana"
def_30$name[def_30$name=="Iran (Islamic Republic of)"]<-"Iran"
def_30$name[def_30$name=="Lao People's Democratic Republic"]<-"Laos"
def_30$name[def_30$name=="Micronesia (Federated States of)"]<-"Micronesia"
def_30$name[def_30$name=="Republic of Korea"]<-"South Korea"
def_30$name[def_30$name=="Republic of Moldova"]<-"Moldova"
def_30$name[def_30$name=="Réunion"]<-"Reunion"
def_30$name[def_30$name=="Russian Federation"]<-"Russia"
def_30$name[def_30$name=="Saint Vincent and the Grenadines"]<-"Saint Vincent"
def_30$name[def_30$name=="Syrian Arab Republic"]<-"Syria"
def_30$name[def_30$name=="Trinidad and Tobago"]<-"Trinidad"
def_30$name[def_30$name=="United Kingdom of Great Britain and Northern Ireland"]<-"UK"
def_30$name[def_30$name=="United Republic of Tanzania"]<-"Tanzania"
def_30$name[def_30$name=="United States of America"]<-"USA"
def_30$name[def_30$name=="Venezuela (Bolivarian Republic of)"]<-"Venezuela"
def_30$name[def_30$name=="Viet Nam"]<-"Vietnam"
```
  
**1.2 Data on forest disturbances:**
```{r echo=FALSE, message=FALSE}
fra_data_tmp <- tibble(read_csv("data/fao_fra_datasets/fra_forest_disturbance_data.csv"))
fra_data_tmp %>% drop_na() %>% select(name, year, contains('5'))
```
First we remove everything that we won't need and make column names (of columns that we will later need) more readable: 

* The 'regions' column gets exchanged by a continent column which provides more intuitive information. 
* The 'iso3' column doesn't provide any further information.
* The name and continent column are changed to factor variables.  

We also replace missing values with 0, because there is no safe way to impute these values, TODO since we don't yet know if there is a pattern in the data. However this implies that our results for this part of the project are probably an underestimation.
```{r fra_data_processing}
fra_data <- fra_data_tmp %>%
  mutate(continent = countrycode(sourcevar = iso3, origin = "iso3c", destination = "continent"),
         across(everything(), ~ replace_na(.x, 0)),
         name = factor(name),
         continent = factor(continent)) %>% 
  select(-c(iso3, regions)) %>% 
  rename(Insects = `5a_insect`, 
         Diseases = `5a_diseases`, 
         Weather = `5a_weather`, 
         Others = `5a_other`,
         Fire = `5b_fire_forest`) %>% 
  #rename_with(str_to_title) %>% 
  relocate(name, continent, year, Insects, Diseases, Weather, Others, Fire)

temp_fra <- fra_data_tmp %>%
  mutate(continent = countrycode(sourcevar = iso3, origin = "iso3c", destination = "continent"),
         name = factor(name),
         continent = factor(continent)) %>% 
  select(name, continent, year, `5b_fire_forest`) %>% 
  pivot_wider(names_from = year, values_from =  `5b_fire_forest`) %>% 
  drop_na() %>% 
  pivot_longer(cols = -c(name, continent), names_to = "year", values_to = "Fire") %>% 
  mutate(year = as.double(year))
fra_data_tmp %>% select(contains('5'))%>% vis_miss()
fra_data_tmp %>% select(name) %>% unique()
fra_data
rmarkdown::paged_table
# Use maybe kable table
# fra_data %>% 
#  kable(caption = "Data on forest desturbances") %>% 
#  scroll_box(width = "100%", height = "200px")
```

**1.3 Data on further topics (e.g. Forest Management / Ownership) for the period 1990-2020 (not every year included).**
```{r echo=FALSE, message=FALSE}
fra <- tibble(read_csv("data/fao_fra_datasets/fra_further_topics_data.csv"))
fra %>% select(name, year, '7a_employment_tot', '4a_priv_own')
fra %>% select(contains('1a'))%>% vis_miss()
```

## FAOSTAT Domain Forests  
The next dataset is also from the FAO [@fao2020forestemissions] and contains data on emissions and area change due to gain and losses of carbon stocks in living tree biomass for the period 1990-2020.
```{r echo=FALSE, message=FALSE}
emissions <- tibble(read_csv("data/fao_forest_datasets/fao_net_emissions_data.csv"))
emissions %>% select(Area, Item, Element, Year, Value)
```

This dataset captures the carbon stock per country for selected 9 years (1990,2000,2010,2015,2016,2017,2018,2019,2020)

**Preprocessing**

1. Some columns were converted to a consistent data type\
2. Missing values were handled with the mice library\
3. Years not captured in the dataset were replaced with the mean carbon stock per country\
4. The unit of the carbon stock was tonnes/ha, where ha is the forest size in hectres\
5. Hence carbon stock was multiplied with forest area.
6. Finally, the emission dataset was merged with the carbon stock to perform correlation.

```{r carbon-stock-dataset, include=FALSE}
data <- tibble(read.csv("data/fao_fra_datasets/fra_carbon_stock_data.csv"))
data$X1990 <- as.numeric(data$X1990)
data <- data[which(rowMeans(is.na(data))<0.5), ]
impute_data <- mice(data, m=5, maxit = 5, seed = 100)
clean_data <- complete(impute_data, 2)
clean_data <- group_by(clean_data, country)
clean_data <- mutate(clean_data, dataMean = mean(c(X1990,X2000,X2010,X2015,X2016,X2017,X2018,X2019,X2020)))

clean_data <- cbind(clean_data, replicate (22, clean_data$dataMean),simplify = FALSE)
clean_data <- setnames(clean_data, old = c("...12","...13","...14","...15","...16","...17","...18","...19","...20",
                                           "...21","...22","...23","...24","...25","...26","...27","...28","...29",
                                           "...30","...31","...32","...33"),
                       new = c("X1991","X1992","X1993","X1994","X1995","X1996","X1997","X1998","X1999","X2001","X2002",
                               "X2003","X2004","X2005",
                               "X2006","X2007","X2008","X2009","X2011","X2012","X2013","X2014"), skip_absent = TRUE)
clean_data <- select(clean_data,'country',c("X1990","X1991","X1992","X1993","X1994","X1995","X1996","X1997",
                                            "X1998","X1999","X2001","X2002","X2003","X2004","X2005","X2006",
                                            "X2007","X2008","X2009","X2011","X2012","X2013","X2014","X2015","X2016",
                                            "X2017","X2018","X2019","X2020"))
carbonStockData <- pivot_longer(clean_data, X1990:X2020, names_to = 'year', values_to = 'carbonStockValue')
carbonStockData <-separate(carbonStockData, col=year, into = c("y","year"), sep="X")
carbonStockData$y <- NULL


forestArea <- read_csv("data/fao_forest_datasets/fao_forest_area_data.csv", col_types = cols())
colnames(forestArea)[colnames(forestArea) == "Area"] <- "country"
colnames(forestArea)[colnames(forestArea) == "Value"] <- "Area"
colnames(forestArea)[colnames(forestArea) == "Year"] <- "year"
forestArea <- select(forestArea, c('country', 'year','Area'))

#merging carbonstock dataset with Forest Area dataset
carbonStockData <- merge(carbonStockData, forestArea, by=c("country","year"))
carbonStockData <- mutate(carbonStockData, carbonInTonnes = (carbonStockValue * Area))
```
**Missing , Shweta's part**

```{r Load-Country-data}
forest_countries <- read_csv("data/fao_forest_datasets/fao_forest_area_data.csv", col_types = cols())
forest_countries %>% relocate(contains('1'))%>% vis_miss()

colnames(forest_countries)[colnames(forest_countries) == "Value"] <- "ForestArea"
colnames(forest_countries)[colnames(forest_countries) == "Area"] <- "Country"
forest_countries <- forest_countries %>% subset(Country != "USSR")
forest_countries <- forest_countries %>% subset(Country != "China, mainland")

forest_countries
```

**Forest land of continents**
The last dataset is about the forest cover of the continents.

```{r read-dataset}
# forest cover of continents dataset
forest_continents <- read_csv("data/fao_forest_datasets/fao_continents_data.csv", col_types = cols())

# change column names
colnames(forest_continents)[colnames(forest_continents) == "Value"] <- "ForestSize"
colnames(forest_continents)[colnames(forest_continents) == "Area"] <- "Continent"

forest_continents

```

Here we have pre-processed out dataset

* We have imputed the missing values by dropping them 

```{r data-wrangling}
newData <- forest_continents %>%
  drop_na() %>% 
  select(c("Continent","Year","ForestSize")) %>% 
  group_by(Continent, Year) %>% 
  arrange(Year) %>% 
  mutate(AvgforestSize = mean(ForestSize))

newData
```

## FAOSTAT Domain Temperature Change  
To work on wildfire predictions due to temperature rise we need data on mean surface temperature change as well. In this case for the period 1961-2020. The temperature increase ("Value") given in this dataset is in relation to a baseline temperature which corresponds to the period of 1951–1980 [@fao2020temp].
```{r echo=FALSE, message=FALSE}
temperature_data_tmp <- tibble(read_csv("data/fao_temperature_change_data.csv"))
temperature_data_tmp
```

Again we remove everything that we won't need: 

* All 'Code'-columns: Add no information.
* All years that are not in 2000-2017: No forest data for these years.
* The Unit column: it's always °C.
* All missing values (Flags != "Fc") and afterwards the flag column.

```{r temp_data_processing}
temperature_data <- temperature_data_tmp %>% 
  filter(Year %in% 2000:2017,
         Flag == "Fc") %>% 
  select(-c(contains("Code"), Flag, Unit))

temperature_data
```

## OECD Air quality and health: Exposure to PM2.5 fine particles
Our fourth dataset was created by the OECD and holds data on mean population exposures to outdoor and ambient PM2.5 particles for the period 1990-2019 (not every year included) [@oecdpollution].
```{r echo=FALSE, message=FALSE}
AirPollution <- tibble(read_csv("data/oecd_air_pollution_data.csv"))
AirPollution %>% select(Country, Variable, Year, Value)
```
The air pollution data has air quality value in microgram cubic metre from the year 1990 to 2019. However, a few years \n data is not available.
Air quality shows changes in the amount of pollution in the air. 

```{r air-pollution-data, include=FALSE}
colnames(AirPollution)[colnames(AirPollution) == "Value"] <- "AirPollution"
glimpse(AirPollution)

AirPollution <- AirPollution %>% 
  select(c("Country", "Year","AirPollution")) %>% 
  group_by(Country,Year) %>% 
  glimpse()

```

## Climate Watch GHG Emissions
The CAIT dataset contains data on greenhouse gas (GHG) emissions for the period from 1990-2018 [@cait].
```{r echo=FALSE, warning=FALSE}
emissionData <- read_csv("data/cait_emissions_data.csv", col_types = cols())
emissionData %>% mutate(`1990` = as.double(`1990`)) %>% select(Country, Sector, Gas, `1990`, `2018`)
```

2. [Carbon Stock Dataset](https://fra-data.fao.org/WO/fra2020/home/)
3. [Forest Area Dataset](http://www.fao.org/faostat/en/#data/GF)

**Preprocessing**
The first dataset containing data about the volume of carbon emitted per country per year (1990-2020) is processed here

1. Some columns were processed to make them consistent with others and for easy identification\
2. Missing values and and irrelevant columns were dropped \
3. The year column was made longer (pivot_longer).

```{r emissiondataSet, warning=FALSE}
colnames(emissionData)[colnames(emissionData) == "Country"] <- "country" 
colnames(emissionData)[colnames(emissionData) == "Data source"] <- "DataSource" 
emissionData$`1990` <- as.numeric(emissionData$`1990`)

emissionData <- emissionData %>%
 drop_na()%>%
 select(-DataSource, -Sector, -Unit)%>%
 pivot_longer(!c(country,Gas), names_to = "year", values_to = "emissionValue")%>%
 filter(country!='World' & country != "European Union (27)")
```


## [FAO. 2021. AQUASTAT Database](http://www.fao.org/aquastat/statistics/query/results.html)  
Our next dataset is the AQUASTAT database from the FAO which shows data of annual averages on precipitation and renewable water resources between 1961-1990.
```{r echo=FALSE, message=FALSE, warning=FALSE}
tmp <- tibble(read_csv("data/aquastat.csv"))
aquastat <- tmp %>% filter(Year == 2017) %>% select(Area, `Variable Name`, Value) %>% pivot_wider(names_from = `Variable Name`, values_from = Value) %>% select(Area, `Long-term average annual precipitation in volume`, `Total renewable water resources`)
aquastat
```

# Global Forest Development

Our first chapter of the project gives an overview over the global forest development in the last 30 years. 

## Global forest trends

Starting with the current status of our global forests, the trend line of the global forest area over the last 30 years gives an overview how the forest area of continents developed in the last 30 years. One can see a decrease in the Americas and Africa while Asia recorded a slight increase in forest area. The forest area in Europe as well in Oceania (containing Australia) seems to be quite stable.

```{r forest-continents-scatter-plot}
newData  %>% 
  ggplot(aes(x = Year, y = ForestSize)) +
  geom_point(aes(color = Continent), size = 3, shape = 16, alpha = 0.7) +
  scale_y_continuous(limits = c(100000, 1800000), labels = scales::comma) +
  labs(
    x = "Years",
    y = "Forest area [1000 ha]",
    title = "Global forest area over the last 30 years"
  ) +
  theme_minimal()
```

The following map is visualizing the change in forest area from 1990 - 2020 for each country (by hovering over it). It underlines our previous results. While Brazil and therefore South America in general faces worldwide the highest decrease in forest area, China and other Asian countries report a higher value in 2020 compared to 1990.

```{r}
tmp <- fra %>% 
  select(iso3, name, year, `1a_forestArea`) %>% 
  filter(year == 1990 | year == 2020) %>% 
  pivot_wider(names_from = year, values_from = `1a_forestArea`) %>% 
  mutate(diff = `2020` - `1990`)

l <- list(color = toRGB("grey"), width = 0.5)

g <- list(
  showframe = FALSE,
  showcoastlines = FALSE
)

limit <- max(abs(tmp$diff)) * c(-1, 1)

div(
  plot_ly(tmp, type='choropleth', locations=tmp$iso3, z=tmp$diff, text=tmp$name, colors = "PRGn", marker = list(line = l)) %>%
colorbar(title = "Forest Area\n[1000 ha]", limits = limit) %>%
  layout(
    title = 'Change in forest area from 1990 - 2020',
    geo = g
  ), align = "right")
```

## Countries with the largest forest area

Before we continue with our deeper analysis, we also want to highlight which countries hold the most forest area on our Earth.

```{r top-10-countries-with-largest-forest-area-plot, message=FALSE}

top10 <- forest_countries %>% 
  filter(Year == 2020) %>% 
  drop_na() %>% 
  arrange(desc(ForestArea)) %>%
  top_n(10) %>% 
  select(Country, ForestArea)

rest <- forest_countries %>% 
  filter(Year == 2020) %>% 
  drop_na() %>% 
  arrange(desc(ForestArea)) %>%
  slice(11:n()) %>% 
  summarise(Country = "Other Countries",
    ForestArea = sum(ForestArea))

top_data <- bind_rows(top10, rest) %>% mutate(Country = factor(Country))

top_data %>% 
  ggplot(aes(x = ForestArea, y = fct_rev(fct_inorder(Country)))) +
  geom_col(fill = "#1c9099") +
  theme(legend.position = "none") +
  labs(
    x = "Forest area [1000 ha]",
    y = "Country",
    title = "Top 10 countries with the largest forest area",
    subtitle = "For the year 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black"), text = element_text(family="Arial")) 
```

The results are not really surprising as those countries have also the highest surface worldwide. However, if you take for example Russia's forest area into relation with the forest area of the rest of the world, outside the top ten countries, it shows quite impressive results. Besides that the top 10 countries have in sum more forest area than the rest of the world together.

# Deforestation

In our analysis we are now attempting to answer important questions regarding deforestation, which is actually a part of forest destruction. However we want to highlight this issue in an own chapter as it is directly made by humans. 
Therefore we will have a look on the main drivers (by countries) of deforestation, showing trends over the continents and making a prediction of how many years it would take until all forests are lost by putting the deforestation and reforestation values over the last 30 years into relation.
  
## Main drivers of deforestation and forest prediction

By hovering over the following map you can find the data for every country regarding the percentage of forest lost through deforestation in the last 30 years in relation to 1990, the value for deforestation in the last 30 years, the current forest area [1000 ha] and the number of years in which the forest area will be completely lost, given the deforestation for each country in the last 30 years.

The color scale is showing the percentage of forest lost, which is making the main drivers of deforestation visible. 

```{r echo=FALSE,  message=FALSE,warning=FALSE}

def_30$code <- countrycode(sourcevar = def_30$name,
                                origin = "country.name",
                                destination = "iso3c")

l <- list(color = toRGB("grey"), width = 0.5)

g <- list(
  showframe = FALSE,
  showcoastlines = FALSE,
  showocean=TRUE, oceancolor="LightBlue"
)
div(
  plot_ly(def_30, type='choropleth', locations=~def_30$code, z=~def_30$percent_change_1, text=~paste(name,paste("Deforestation in the last 30 years:",t_deforestation ), paste("Current forest area:",`2020` ), paste("Years until forest area will be lost:", year) ,sep = "<br />"), marker = list(line = l), colors = "Purples")  %>% 
  colorbar(title = "Forest loss through deforestation [%]", ticksuffix = '%') %>% 
  layout(
    title = 'Deforestation analysis of the last 30 years',
    geo = g
  ), align = "right")
```


Note: for some countries the deforestation data is 0 or not available. If possible, for those countries the deforestation value was calculated by the difference of the forest area between 1990 and 2020. Otherwise they are colored white.

## Deforestation trends by continents 

The chart below shows trends in the deforestation over the last thirty years over 5 continents. Unfortunately, our dataset only provides intervals in 5 respectively 10 year steps, which is why it is not possible to show a more precise trend line.

```{r echo=FALSE, message=FALSE, warning=FALSE}
world <- map_data("world") %>% 
  group_by(region) %>% 
  filter(row_number()==1)
colnames(world)[5]<-"name"

def_30_world<-inner_join(world,def_30,by="name")
trends<- inner_join(world,intervals_1,by="name") %>% inner_join(Forest_Area,by="name") %>% select(name,year,`1d_deforestation`,`1d_expansion`,`1d_afforestation`,`1e_reforestation`,`1d_nat_exp`)
trends$continent <- countrycode(sourcevar = trends$name,
                            origin = "country.name",
                            destination = "continent")
trends$year[trends$year=="2010-2015"]<-"2010-2020"
trends$year[trends$year=="2015-2020"]<-"2010-2020"

trends$year[trends$year=="1990-2000"]<-0
trends$year[trends$year=="2000-2010"]<-1
trends$year[trends$year=="2010-2020"]<-2

trends_def<-trends %>% group_by(year,continent) %>% summarize(t_deforestation =sum(as.numeric(`1d_deforestation`),na.rm = TRUE),t_expansion=sum(as.numeric(`1d_expansion`),na.rm = TRUE),t_afforestation =sum(as.numeric(`1d_afforestation`),na.rm = TRUE),t_reforestation =sum(as.numeric(`1e_reforestation`),na.rm = TRUE),t_nat_exp =sum(as.numeric(`1d_nat_exp`),na.rm = TRUE)) %>% ungroup()

#%>% pivot_longer(cols = contains("t_"),names_to = "continent",values_to = )

ggplot(trends_def, aes(x = as.integer(year), y = t_deforestation, color = continent)) +
  geom_point(aes(color = continent)) +
  geom_line() +
  scale_x_continuous(breaks = c(0,1,2), labels = c("1990-2000", "2000-2010", "2010-2020")) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = 'Deforestation Trends on continents between 1990-2020',
    x = 'Year',
    y = 'Deforestation [1000 ha]',
    color = "Continent"
  ) +
  theme_minimal()
```

Note: the Americas refer to North and South America.

# Reforestation

In this part we want to dig in deeper into the topic of the reforestation by analyzing which countries are the main drivers, whether there is a correlation between reforestation and deforestation and showing the trends over continents.

## Main drivers of reforestation

```{r, include=FALSE}
reforestation <- intervals %>% 
  select(name, year, `1e_reforestation`) %>% 
  mutate(`1e_reforestation` = case_when(
    year == c("1990-2000", "2000-2010") ~ `1e_reforestation` * 10,
    TRUE ~ `1e_reforestation` * 5
    )) %>% 
  group_by(name) %>% 
  summarise(totalref = sum(`1e_reforestation`, na.rm = TRUE)) %>% 
  ungroup()  %>%
  arrange(desc(totalref))

```



```{r, include=FALSE}
refplot <- reforestation %>%
  head(20)

rest_ref <- reforestation %>% 
  slice(21:n()) %>% 
  summarise(name = "Other Countries",
    totalref = sum(totalref))

ref_data <- bind_rows(refplot, rest_ref) %>% mutate(name = factor(name))
```


```{r, echo=FALSE}
 ggplot(ref_data, aes(x = totalref, y = fct_rev(fct_inorder(name)))) +
  geom_col(fill = "Forestgreen") +
  labs(
    y = "Increase between 1990-2020 [1000 ha]",
    x = NULL,
    title = "Top 20 countries of total reforestation between 1990 and 2020"
  ) 
```

As these results show mainly countries with a huge surface, we want to put the increase of reforestation from 1990-2020 in relation to the forest area in 1990. 

```{r, include = FALSE}
area <- fra %>%
    group_by(name) %>%
    filter(year == 1990) %>%
    select(name, `1a_forestArea`)
```


```{r, include = FALSE}
increase <- reforestation %>%
  inner_join(area, by = "name") %>%
  mutate(reforestation_increase = (totalref/`1a_forestArea`) * 100) %>%
  arrange(desc(reforestation_increase))
```

```{r, echo=FALSE}
increase %>%
    arrange(desc(reforestation_increase)) %>%
    head(20)%>%
  ggplot(mapping = aes(x = reorder(name, reforestation_increase), y = reforestation_increase)) +
  geom_col(fill = "Forestgreen") +
  labs(
    y = "Increase in %",
    x = NULL,
    title = "Countries and their increase in reforestation from 1990-2020\nin relation to their total forest area in 1990"
  ) +
  coord_flip()
```

This leads us to quite surprising results, e.g. that Algeria is the country with the highest reforestation increase given the total forest area in 1990. Nevertheless this doesn't come out of nowhere, along with other North African countries, Algeria is pursuing several reforestation projects such as the great green wall or "barrage vert" [@tagesschau]. This results in the fact, that Algeria is one of the countries which has a higher forest cover in 2020 than in 1990.

```{r, include = FALSE, warning = FALSE}
increase$code <- countrycode(increase$name, origin = "country.name", destination = "iso3c")
```

By hovering over the following map, a tooltip of the reforestation increase for each country is shown. The greener the country, the higher is the increase.

```{r, echo=FALSE, warning = FALSE}

l <- list(color = toRGB("grey"), width = 0.5)

g <- list(
  showframe = FALSE,
  showcoastlines = FALSE
)

increase$reforestation_increase <- round(increase$reforestation_increase)

div(
  plot_ly(increase, type='choropleth', locations=increase$code, z=increase$reforestation_increase, text=increase$name, colors = "Greens", marker = list(line = l)) %>% 
colorbar(ticksuffix = '%') %>%
  layout(
    title = 'Increase in reforestation between 1990 and 2020 in %', 
    geo = g
  ), align = "right")
```


## Relation between reforestation and deforestation

After we have now an overview on reforestation and deforestation we want to answer the question whether governments try to "make up" for the deforestation in the last 30 years.

```{r, include = FALSE}
deforestation <- intervals %>% 
  select(name, year, `1d_deforestation`) %>% 
  mutate(`1d_deforestation` = case_when(
    year == c("1990-2000", "2000-2010") ~ `1d_deforestation` * 10,
    TRUE ~ `1d_deforestation` * 5
    )) %>% 
  group_by(name) %>% 
  summarise(totaldef = sum(`1d_deforestation`, na.rm = TRUE)) %>% 
  ungroup() %>% 
  arrange(desc(totaldef))
```


```{r, include = FALSE}
corref <- reforestation %>%
 inner_join(deforestation, by = "name") %>%
 select(name,totalref, totaldef)
```

First of all we want to show the relation of total reforestation and deforestation in the last 30 years, to get a first impression.

```{r, echo=FALSE, warning = FALSE, message = FALSE}
ggplot(data = corref, mapping = aes(x = totalref, y = totaldef)) +
  geom_point(alpha=0.5) +
  geom_smooth(se = FALSE) +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  ggrepel::geom_text_repel(
    data = filter(corref), 
    aes(label = name), 
    color = "black", size = 7/.pt)+
  labs(x = "Total reforestation [1000 ha]", y = "Total deforestation [1000 ha]")
```

There are many outliers with either very high deforestation or reforestation figures. However, such outliers are not surprising when taking a look into recent news.For example Brazil, a country with one of the biggest rainforest areas, has been making negative headlines for years with it's environment politics [@zeitamazonas].

We now zoom in to have a closer look on the data without the outliers by downsizing the scale.

```{r, echo=FALSE, warning = FALSE, message = FALSE}
ggplot(data = corref, mapping = aes(x = totalref, y = totaldef)) +
  geom_point(alpha=0.5) +
  scale_x_continuous(limits = c(0, 5000), labels = scales::comma) +
  scale_y_continuous(limits = c(0, 10000), labels = scales::comma) +
  ggrepel::geom_text_repel(
    data = filter(corref), 
    aes(label = name), 
    color = "black", size = 7/.pt)+
  labs(x = "Total reforestation [1000 ha]", y = "Total deforestation [1000 ha]")
```

The figure shows already a high and not linear distrubtion of our data.

```{r, include = FALSE}
corref <- corref %>%
select(totalref, totaldef)
```

With the Shapiro-Wilk test we want to show the normality of our data.

```{r, echo=FALSE}
shapiro.test(corref$totalref)
shapiro.test(corref$totaldef)
```

The values are below 0.05 for both, reforestation and deforestation, the data significantly deviate from a normal distribution. A result which was already highlighted by the graph.

As the data is therefore not linear, we should choose the Spearman method to calculate the correlation.

```{r, echo=FALSE, warning = FALSE}
corrr::correlate(corref, quiet = TRUE, method = "spearman") 
Spear <- cor.test(corref$totalref, corref$totaldef, method = 'spearman')
Spear
```

With  a value of 0.451 it shows a moderate correlation, which means, that deforestation has actually an impact on reforestation and a relationship exists. 
 
```{r}
pps <- score_df(corref %>% select(totalref, totaldef))

pps
```

Additionally, we calculated the power predictive score to calculate the impact of deforestation on reforestation. However this value is with 0.15 not as high as expected after the correlation result.

## Reforestation trends by continent

Finally we are going to take a look on the trend line of the continents and their given total reforestation in the given time intervals of 10 years between 1990 and 2020.

```{r, include = FALSE}
intervals_1<-intervals %>% 
mutate(`1e_reforestation`=case_when(year %in% c("1990-2000","2000-2010")~`1e_reforestation`*10,year %in% c("2010-2015","2015-2020")~`1e_reforestation`*5))
```


```{r, include = FALSE}
world <- map_data("world") %>% 
  group_by(region) %>% 
  filter(row_number()==1)
colnames(world)[5]<-"name"
  
```

```{r, echo=FALSE, message = FALSE}
trends<- inner_join(world,intervals_1,by="name") %>% 
  select(name,year,`1e_reforestation`)
trends$continent <- countrycode(sourcevar = trends$name,
                            origin = "country.name",
                            destination = "continent")
trends$year[trends$year=="2010-2015"]<-"2010-2020"
trends$year[trends$year=="2015-2020"]<-"2010-2020"

trends$year[trends$year=="1990-2000"]<-0
trends$year[trends$year=="2000-2010"]<-1
trends$year[trends$year=="2010-2020"]<-2

trends_ref<-trends %>% 
  group_by(year,continent) %>% summarize(t_reforestation =sum(as.numeric(`1e_reforestation`),na.rm = TRUE)) %>% ungroup()

ggplot(trends_ref, aes(x = as.integer(year), y = t_reforestation, color = continent)) +
  geom_point(aes(color = continent)) +
  geom_line() +
  scale_x_continuous(breaks = c(0,1,2), labels = c("1990-2000", "2000-2010", "2010-2020")) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = 'Reforestation Trends on continents between 1990-2020',
    x = 'Year',
    y = 'Reforestation [1000 ha]',
    color = "Continent"
  ) +
  theme_minimal()
```

One can notice, that reforestation is increasing on many continents, while in the deforestation part we could detect a decrease of deforestation in some continents. It would be very interesting to do another correlation analysis in a few years. The trend seems to be clearly going in the direction of a higher correlation that deforestation has an impact on reforestation, at least for some continents and countries.

# Forest Destruction

The next part of our project is about forest destruction and tries to answer what the main causes of forest destruction are and which countries are affected the most. We also take a look at the relationship between wildfires and rising temperatures and try to predict where and when wildfires are likely to occur.

For the first two questions we decided to look at a global scale and for the country Germany.  
For the third question we decided to look at a global scale and for the continent Europe.

Note: In our interactive shiny website you can pick the country / continent of your interest.

## Main causes of forest destruction

```{r overview}
plot_yearly_forest_destruction_by_region <- function(region = 'Global') {
  fra_data %>% 
    filter(name == region | continent == region | region == 'Global') %>% 
    group_by(year) %>% 
    summarise(Insects = sum(Insects, na.rm = TRUE),
              Diseases = sum(Diseases, na.rm = TRUE),
              Weather = sum(Weather, na.rm = TRUE),
              Others = sum(Others, na.rm = TRUE),
              Fire = sum(Fire, na.rm = TRUE)) %>% 
    pivot_longer(cols = c(Insects, Diseases, Weather, Others, Fire), names_to = "cause", values_to = "area") %>% 
    mutate(cause = factor(cause)) %>% 
    ggplot(aes(x=year, y=area, fill= cause %>% fct_reorder(area) %>% fct_relevel("Others", after = Inf))) +
    geom_area() +
    scale_x_continuous(breaks = c(2000, 2005, 2010, 2015, 2017)) +
    scale_y_continuous(labels = scales::comma) +
    scale_fill_manual(values = c(Weather = "#2b83ba", Others = "#ffffbf", Fire = "#d7191c",
                                 Diseases = "#fdae61", Insects = "#abdda4")) +
    labs(title = "Forest destruction per year and cause",
         subtitle = glue::glue("Region: {region} - Time period: 2000 - 2017"),
         x = "Year",
         y = "Forest Area [1000 ha]",
         fill = "Cause") +
    theme_minimal()
}

plot_yearly_forest_destruction_by_region()
plot_yearly_forest_destruction_by_region('Germany')
```

On a global scale wildfires are clearly the dominant cause of forest destruction over the years. However, this does not apply for every individual country. For example: Germany's main cause of forest destruction are insects. One can also see that there is no obvious trend to find over this small time scale.

Note: the peak in the plot about Germany was caused by the heat wave in 2003.

## Destroyed forest by cause

```{r area_by_cause, echo=FALSE}

plot_total_forest_destruction_by_region <- function(region = 'Global') {
  disturbance_data <- fra_data %>% 
    filter(name == region | region == 'Global') %>% 
    select(-`5b_fire_land`) %>% 
    mutate(Insects = sum(Insects, na.rm = TRUE)) %>% 
    mutate(Diseases = sum(Diseases, na.rm = TRUE)) %>% 
    mutate(Weather = sum(Weather, na.rm = TRUE)) %>% 
    mutate(Others = sum(Others, na.rm = TRUE)) %>% 
    mutate(Fire = sum(Fire, na.rm = TRUE)) %>% 
    pivot_longer(cols = c(Insects, Diseases, Weather, Others, Fire), names_to = "cause", values_to = "area") %>% 
    mutate(cause = factor(cause)) %>% 
    slice(1:5) %>% 
    select(cause, area)
  
  bar_plot <- ggplot(disturbance_data, aes(x = cause %>% fct_reorder(desc(area)) %>% fct_relevel("Others", after = Inf), y = area, fill = cause)) + 
    geom_col() +
    labs(title = "Total forest destruction by cause",
         subtitle = glue::glue("Region: {region} - Time period: 2000 - 2017"),
         x = "",
         y = "Forest Area [1000 ha]") +
    scale_y_continuous(labels = scales::comma) +
    scale_fill_manual(values = c(Weather = "#2b83ba", Others = "#ffffbf", Fire = "#d7191c",
                                 Diseases = "#fdae61", Insects = "#abdda4")) +
    theme_minimal() +
    guides(fill = FALSE)
  
  pie_plot <- ggplot(disturbance_data, aes(x="", y = area, fill = cause %>% fct_reorder(desc(area)) %>% fct_relevel("Others", after = Inf))) + 
    geom_bar(stat="identity", width=1) +
    coord_polar("y") +
    scale_fill_manual(values = c(Weather = "#2b83ba", Others = "#ffffbf", Fire = "#d7191c",
                                 Diseases = "#fdae61", Insects = "#abdda4")) +  
    labs(x = "",
         y = "Forest Area [1000 ha]",
         fill = "Cause") +
    theme_void()
  
  bar_plot + pie_plot
}

```

```{r}
plot_total_forest_destruction_by_region()
```

```{r}
plot_total_forest_destruction_by_region('Germany')
```

Again we can see the huge impact of wildfires. On a global scale they make up more than 50% of forest destruction, destroying more than 1 Billion ha of forest. Insects make up almost 25% of forest destruction, destroying roughly 500 Million ha of forest. These two are clearly the main drivers of global forest destruction.

In Germany insects and diseases are the main drivers of forest destruction, destroying approximately 2.5 Million ha of forest over this 18 years time period. However, wildfires are no significant problem at all in Germany. 

## Most affected countries

```{r most_affected}
plot_highest_forest_destruction <- function(cont = 'Global', number = 15, cs = 'All') {
  
  fra_data %>% 
    filter(continent == cont | cont == 'Global') %>% 
    select(name, c(Insects, Diseases, Weather, Others, Fire)) %>% 
    group_by(name) %>% 
    summarise(Insects = sum(Insects, na.rm = TRUE),
              Diseases = sum(Diseases, na.rm = TRUE),
              Weather = sum(Weather, na.rm = TRUE),
              Others = sum(Others, na.rm = TRUE),
              Fire = sum(Fire, na.rm = TRUE)) %>% 
    ungroup() %>% 
    pivot_longer(cols = c(Insects, Diseases, Weather, Others, Fire), names_to = "cause", values_to = "area") %>% 
    filter(cause == cs | cs == 'All') %>% 
    group_by(name) %>% 
    mutate(total = sum(area, na.rm = TRUE)) %>% 
    ungroup() %>% 
    arrange(desc(total)) %>% 
    slice(1:(5*number)) %>% 
    ggplot(aes(x=area, y=reorder(name, area), fill=reorder(cause, desc(area)))) +
    geom_col() +
    scale_x_continuous(labels = scales::comma) +
    scale_fill_manual(values = c(Weather = "#2b83ba", Others = "#ffffbf", Fire = "#d7191c",
                                 Diseases = "#fdae61", Insects = "#abdda4")) + 
    labs(title = glue::glue("The {number} Countries with the highest forest destruction"),
         subtitle = glue::glue("Region: {cont} - Time period: 2000 - 2017"),
         x = "Forest Area [1000 ha]",
         y = "Country",
         fill = "Cause") +
    theme_minimal()
  
}

plot_highest_forest_destruction()
#ggplotly(plot_highest_forest_destruction())
plot_highest_forest_destruction("Europe", 5, "All")
```

As one would expect from our previous findings, the most affected countries mostly struggle with wildfires. The only exceptions to this are the USA, Canada, China, Sudan and Mexico. Brazil is the most affected country and has a huge wildfire problem. However, since Brazil is a tropical region and therefore very humid these wildfires are most likely caused by humans [@zeitamazonas]. For Europe one can see that except for Russia, Europe's most affected countries have no problem with wildfires. 

## Relation between rising temperatures and wildfires

**Overview:**

```{r fire_temp_corr_preprocessing, include=FALSE}
global_yearly_tc <- temperature_data %>% 
  filter(Area == 'World', 
         Element == 'Temperature change', 
         Months == 'Meteorological year'
  ) %>% 
  select(Year, Value) %>% 
  rename(year = Year, temp_increase = Value)

global_yearly_tc

fra_tc_global <- inner_join(temp_fra, global_yearly_tc, by=c("year"))

fra_tc_global
```

```{r todo, include=FALSE}
local_yearly_tc <- temperature_data %>% 
  filter(Element == 'Temperature change', 
         Months == 'Meteorological year') %>% 
  select(Area, Year, Value) %>% 
  rename(name = Area, year = Year, temp_increase = Value)

fra_tc_local <- inner_join(fra_data, local_yearly_tc, by=c("name", "year"))

fra_tc_local
```

```{r fire_temp_corr_plot3}
fra_tc_global %>% 
  group_by(year) %>% 
  summarise(fire = sum(Fire, na.rm = TRUE), 
            temp = mean(temp_increase)) %>% 
  ggplot(aes(x=year, y=fire, fill = temp)) +
  geom_col() + 
  scale_y_continuous(labels = scales::comma) +
  scale_fill_viridis_c(option = "inferno") +
  labs(title = "Global area of wildfires per year",
       subtitle = "Time period: 2000 - 2017",
       x = "Year",
       y = "Wildfire Area [1000 ha]",
       fill = "Temperature increase [C°]") +
  theme_minimal()
```

Our first visualization doesn't suggest any linear correlation, but it can be improved to make the interpretation clearer. Again, the temperature increase given in this dataset is in relation to a baseline temperature which corresponds to the period of 1951–1980.

Next we compare global yearly temperature changes to global forest area destructed by wildfires.

```{r fire_temp_corr_plot, message=FALSE}
# Forest
fra_tc_global %>% 
  group_by(year) %>% 
  summarise(fire = sum(Fire, na.rm = TRUE), 
            temp = temp_increase) %>% 
  ungroup() %>% 
  unique() %>% 
  ggplot(aes(x=temp, y=fire)) +
  geom_point() +
  geom_smooth(method = "lm") +
  ggrepel::geom_text_repel(
    aes(label = year), 
    color = "black", size = 7/.pt) +
  labs(
    title = "Relationship between global temperature increase and wildfire area",
    subtitle = "Time period: 2000 - 2017",
    x = "Temperature Increase [C°]",
    y = "Wildfire Area [1000 ha]" 
  ) +
  theme_minimal()

# Land
# fra_tc_global %>% 
#   group_by(year) %>% 
#   summarise(fire = sum(`5b_fire_land`, na.rm = TRUE), 
#             temp = temp_increase) %>% 
#   ggplot(aes(x=temp, y=fire)) +
#   geom_line() + 
#   geom_point() +
#   labs(
#     title = "Relationship between global temperature increase and gloabl fire area",
#     subtitle = "Time period: 2000 - 2017",
#     x = "Temperature Increase [C°]",
#     y = "Fire Area [1000 ha]" 
#   ) +
#   theme_minimal()

# TODO: Change argumentation chain 
# Keep in mind that land includes forest!!!
```

There is no linear correlation visible for both land and forest fires and rising temperatures.

Now we compare global yearly temperature changes to the global count of wildfires.

```{r fire_temp_corr_plot2, message=FALSE}
# Forest
fra_tc_global %>% 
  mutate(Fire = case_when(
    is.na(Fire) | Fire == 0 ~ FALSE,
    TRUE ~ TRUE
  )) %>% 
  group_by(year) %>% 
  summarise(fire = sum(Fire, rm.na = TRUE), temp = temp_increase) %>% 
  ungroup() %>% 
  unique() %>% 
  ggplot(aes(x=temp, y=fire)) +
  geom_point() +
  geom_smooth(method = "lm") +
  ggrepel::geom_text_repel(
    aes(label = year), 
    color = "black", size = 7/.pt) +
  labs(
    title = "Relationship between global temperature increase and\nthe number of countries which had atleast one wildfires in a given year",
    subtitle = "Time period: 2000 - 2017",
    x = "Temperature Increase [C°]",
    y = "Affected countries" 
  ) +
  theme_minimal()

# # Land
# fra_tc_global %>% 
#   mutate(`5b_fire_land` = case_when(
#     is.na(`5b_fire_land`) | Fire == 0 ~ FALSE,
#     TRUE ~ TRUE
#   )) %>% 
#   group_by(year) %>% 
#   summarise(fire = sum(`5b_fire_land`, rm.na = TRUE), 
#             temp = temp_increase) %>% 
#   ggplot(aes(x=temp, y=fire)) +
#   geom_line() + 
#   geom_point() +
#   labs(
#     title = "Relationship between global temperature increase and the global amount of fires",
#     subtitle = "Time period: 2000 - 2017",
#     x = "Temperature Increase [C°]",
#     y = "Number of wildfires" 
#   ) +
#   theme_minimal()
```

Again there is no linear correlation visible for both land and forest fires and rising temperatures.
Maybe we can find a correlation if go more into detail and show not only global values but values for each country and each year:

```{r}
fra_tc_local %>% 
  filter(!is.na(Fire)) %>% 
  ggplot(aes(y=Fire, x=temp_increase, color = continent)) +
  geom_point(alpha = 0.5) +
  # geom_smooth(se = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Area of wildfires per year and country",
       subtitle = "Time period: 2000 - 2017",
       x = "Temperature increase [C°]",
       y = "Wildfire Area [1000 ha]",
       color = "Continent") +
  theme_minimal()
```

```{r animated_plot}

p <- fra_tc_local %>% 
  filter(!is.na(Fire)) %>% 
  mutate(year = as.integer(year)) %>% 
  ggplot(aes(y=Fire, x=temp_increase, color = continent)) +
  geom_point(alpha = 0.5, show.legend = FALSE) +
  # geom_smooth(se = FALSE) +
  facet_wrap(~continent) +
  scale_y_continuous(labels = scales::comma, limits = c(0,100)) +
  theme_minimal() +
  labs(title = "Area of wildfires per year and country",
       subtitle = "Year: {frame_time}",
       x = "Temperature increase [C°]",
       y = "Wildfire Area [1000 ha]",
       color = "Continent") +
  transition_time(year) +
  ease_aes('linear')


animate(p, renderer = gifski_renderer())
```

```{r}
corr_data <- fra_tc_global %>% 
                   group_by(year) %>% 
                   summarise(Wildfires = sum(Fire, na.rm = TRUE), 
                             Temperature = mean(temp_increase)) %>% ungroup() %>% 
                   select(Temperature, Wildfires)

x <- cor(x = corr_data$Temperature, y = corr_data$Wildfires, use = "everything", method = "kendall")
paste("Kendall = ", x)
```


We need a way to quantify these results. Since the data is clearly not linear we use the Predicitive Power Score [..] as a measure for correlation.

```{r}
pps1 <- score_df(fra_tc_global %>% 
                   group_by(year) %>% 
                   summarise(Wildfires = sum(Fire, na.rm = TRUE), 
                             Temperature = mean(temp_increase)) %>% ungroup() %>% 
                   select(Temperature, Wildfires), cv_folds = 2)

pps1
#p1 <- plot_pps(pps1, "PPS matrix for\nglobal wildfire area")

pps2 <- score_df(fra_tc_global %>% 
                   mutate(Fire = case_when(
                     is.na(Fire) | Fire == 0 ~ FALSE,
                     TRUE ~ TRUE
                   )) %>% 
                   group_by(year) %>% 
                   summarise(Wildfires = sum(Fire, na.rm = TRUE), 
                             Temperature = mean(temp_increase)) %>% 
                   ungroup() %>% 
                   select(Temperature, Wildfires))
pps2
#p2 <- plot_pps(pps2, "PPS matrix for\nglobal wildfire count")

pps3 <- score_df(fra_tc_local %>% select(name, temp_increase, Fire))

pps3
#p3 <- plot_pps(pps3, "PPS matrix for\ncountry wildfire area")
```

There is clearly no correlation recognizable in our data between temperature increase and wildfires.

## Prediction of where and when wildfires are likely to occur

First we look at the available data and see which columns might help us to make a prediction.

```{r wildfire_prediction}
temp <- temperature_data %>% 
  filter(Element == 'Temperature change', 
         Months == 'Meteorological year') %>% 
  select(Area, Year, Value) %>% 
  rename(name = Area, year = Year, temp_increase = Value)

# Interpretation of NA's as No Wild Fire, because of the structur of the entries for this column
fra <- fra_data %>% 
  mutate(wildfire = case_when(
    Fire == 0 ~ "No",
    TRUE ~ "Yes"
  )) %>% 
  mutate(wildfire = factor(wildfire)) 

fra_tc_data <- inner_join(fra, temp, by=c("name", "year"))
fra_tc_data
```
Based on the columns in the table above, we will try to predict if a wildfire occurs or not. So we will use the location, year, forest composition, destruction information and temperature increase.

We got roughly 3800 samples for the prediction

```{r prepare_data}
set.seed(123)

# Specify data splits 
init_split <- initial_split(fra_tc_data, strata = wildfire)
wf_training <- training(init_split)
wf_testing <- testing(init_split)

# 5-fold cross validation
wf_cv <- vfold_cv(wf_training, v = 5)
```

```{r model_specs}
# Logistic regression
lr_model_spec <- logistic_reg() %>%
  set_engine("glm") %>%
  set_mode("classification")

# Decision Tree
dt_model_spec <- decision_tree() %>% 
  set_engine("rpart") %>% 
  set_mode("classification")
```

```{r model_validation}
# Fit models on cv training data
wf <- workflow() %>%
  add_formula(wildfire ~ temp_increase) %>% 
  add_model(lr_model_spec)

lr_results_1 <- wf %>% 
  fit_resamples(wf_cv) %>% 
  collect_metrics()

wf <- wf %>% update_model(dt_model_spec)

dt_results_1 <- wf %>% 
  fit_resamples(wf_cv) %>% 
  collect_metrics()

lr_results_1
dt_results_1

# Decision Tree has a better performance
```

```{r model_validation_2}
# Next step: find optimal formula

wf <- wf %>% update_formula(wildfire ~ name + continent + temp_increase + boreal + temperate+ tropical+ subtropical + Insects + Diseases + Weather + Others + year
)

dt_results_2 <- wf %>% 
  fit_resamples(wf_cv) %>% 
  collect_metrics()

dt_results_2
```

```{r model_evaluation}
dt_fit <- fit(dt_model_spec, wildfire ~ name + continent + temp_increase + boreal + temperate+ tropical+ subtropical + Insects + Diseases + Weather + Others + year, wf_training)
rpart.plot::rpart.plot(dt_fit$fit, roundint = FALSE)

predict(dt_fit, new_data = wf_testing) %>%
  mutate(truth = wf_testing$wildfire) %>%
  accuracy(estimate = .pred_class, truth = truth)

# prediction of when a wildfire occurs sees to be impractical because the most / only important factor is the country
# remove year - doesn't make any sence to use it predict upcoming wildfires

#predict(fit, new_data = wf_testing) %>%
# mutate(truth = wf_testing$wildfire) %>%
#accuracy(estimate = .pred_class, truth = truth)

#predict(fit2, new_data = wf_testing) %>%
# mutate(truth = wf_testing$wildfire) %>%
#accuracy(estimate = .pred_class, truth = truth)
#rpart.plot::rpart.plot(results4$)
```

```{r}
dt_fit <- fit(dt_model_spec, wildfire ~ temp_increase + boreal + temperate + tropical+ subtropical + Insects + Diseases + Weather + Others + year, wf_training)
rpart.plot::rpart.plot(dt_fit$fit, roundint = FALSE)

predict(dt_fit, new_data = wf_testing) %>%
  mutate(truth = wf_testing$wildfire) %>%
  accuracy(estimate = .pred_class, truth = truth)
```

Our most accurate prediction depends only on the given country and is therefore not very useful in finding the underlying source of wildfires, even though it has a accuracy 92%. If we remove the country as a predictor, the main factors for deciding whether a wildfire occurs or not are the type of forests in a given country and the the amount of destroyed forest by insects. Both of these values don't need to be very high to result in a 70% chance of a wildfire in a given country.

# Relation to other environmental issues

In this section, we would like to address some of the aspects that are relevant to climate change, such as air pollution and green house gases (GHG), and provide an outlook on how the development of forest area can have an impact on these topics. In particular we will provide an overview of GHG and the carbon stock in forests all over the world, to calculate then the correlation of those two values. Moreover we will then investigate in how much GHG will be absorbed by an increasing forest area. Also for the air pollution we want to figure out its relationship with the forest area. Finally we will predict, how much forest area will be needed to tackle current CO2 emissions by country.

## Relation between forest area and air pollution


## Top 10 countries with most air pollution
```{r Air-Pollution-plot, echo=FALSE}
AirPollution %>% 
  drop_na() %>% 
  group_by(Country) %>% 
  summarize(avgAirPollution = mean(AirPollution)) %>% 
  as.data.frame() %>% 
  ungroup() %>% 
  arrange(desc(avgAirPollution)) %>%
  top_n(10) %>% 
  ggplot(aes(x = avgAirPollution, y = reorder(Country, avgAirPollution))) +
  geom_col(fill = "#DE8971", width = 0.5) +
  theme(legend.position = "none") +
  labs(
    x = expression(paste("Average air pollution [", mu, "g/", m^3, "]")),
    y = "Country",
    title = "Top 10 countries with the highest air pollution",
    subtitle = "Time period: 1990 - 2020"
  )+
  scale_x_continuous(labels = scales::comma) +
  theme_minimal()+
  theme(axis.title.x = element_text(color = "Black" ), text = element_text(family="Arial"))+
  geom_vline(aes(xintercept=mean(AirPollution$AirPollution)), 
                color = "#204887", size=1)+
  geom_text(aes(x= 38,y= 8.5,label="Global average air pollution"),size=3)
```
Findings:

India has the highest air pollution in the last 30 years 

**Air pollution trend in India**
```{r India-plot, echo=FALSE}

AirPollution_India <- AirPollution %>% 
  group_by(Year) %>% 
  filter(Country == "India") %>% 
  summarize(AirPollution = mean(AirPollution)) %>% 
  ungroup() 
  


AirPollution_India_plot <- AirPollution_India %>% 
  ggplot(aes(x = Year, y = AirPollution))+
  geom_point(color =  "#79198a", size = 3, alpha = 0.6)+
  geom_line(size = 1, alpha = 0.6)+
  labs(title = "Air Pollution in India",
       subtitle = "Time period: 1990-2019",
       x = "Year",
       y = expression(paste("Air pollution [", mu, "g/", m^3, "]")))+
  theme_minimal()+
  theme(axis.title = element_text(),text = element_text(family = "Arial"))+
  theme(plot.subtitle = element_text(size = rel(0.8)))

AirPollution_India_plot
```
Findings:
* Air Pollution drastically increased after the year 2005.
* It was highest in 2012.
* It decreased in 2005 by ~10 Micrograms per cubic metre.
* Sudden decrease around 2017.
* Increased slightly in 2019 again

```{r air-pollution-rest, echo=FALSE}

AirPollution_India <- AirPollution %>% 
  group_by(Year) %>% 
  filter(Country == "India") %>% 
  summarize(Country = "India", AirPollution = mean(AirPollution)) %>% 
  ungroup() 

pollution_rest <- AirPollution %>% 
  drop_na() %>% 
  filter(Country != "India") %>% 
  summarise(Country = "Other Countries",
    AirPollution = mean(AirPollution))
  

trend <- bind_rows(AirPollution_India, pollution_rest) %>% mutate(Country = factor(Country))




trend_plot <- plot_ly(trend, x = ~AirPollution, y = ~factor(Country)) %>%
  add_boxplot(color = ~Country) %>%
  layout(title = "Air Pollution in India and the rest of the World (1990-2020)",
         yaxis = list(title = "") , xaxis = list(title = "Air Pollution (Microgram cubic meter)"))
  
div(trend_plot, align = "right")

```

+ India's Air pollution range lies between 65.3201 microgram (least) cubic meter and ~95.8366(highest) microgram cubic meter



+ The range of  average air pollution for other countries lies between 5.1633 microgram cubic meter and  66.9532 microgram cubic meter


+ However, we see there are a lot of outliers in the other country data where a lot of countries have air pollution ranging above the maximum average value.



```{r merged-data-set, include=FALSE}
mergedData <- merge(forest_countries, AirPollution, by=c("Country","Year")) %>%
  select(c('Country','Year','ForestArea','AirPollution')) %>% 
  drop_na() %>% 
  group_by(Year) %>% 
  summarize(TotalForestArea = sum(ForestArea), TotalAirPollution = sum(AirPollution)) %>% 
  ungroup() %>% 
  unique()
mergedData

```

```{r correlation-plots, echo=FALSE, message=FALSE}
mergedData %>% 
  ggplot(aes(x = TotalForestArea, y = TotalAirPollution)) +
  geom_point(size = 4, alpha=0.7, color = "#056b5f") +
  labs(x="Total Forest Area [1000 ha]", y = "Total Air Pollution", title="Correlation between Forest Area and Air Pollution (globally)") + 
  geom_smooth(method = 'lm')+
  ggrepel::geom_text_repel(
    aes(label = Year), 
    color = "black", size = 7/.pt)+
  scale_x_continuous(labels = scales::comma)+
  scale_y_continuous(labels = scales::comma)
```

**Findings:**
* No linear relationship between Forest Area and Air Pollution

**Correlation Value***
```{r correlation2, echo=FALSE}
corr <- cor(x = mergedData$TotalForestArea, y = mergedData$TotalAirPollution, use = "everything", method = "kendall")
paste("Kendall = ", corr)

```
Findings:
A negative correlation coefficient shows the variables are moving in the opposite direction.

**For more reliable results of the relationship between Forest Area and Air Pollution, we implement Predictive Power Score**

```{r regression, echo=FALSE}
# merge  data sets and remove missing values

data <- merge(forest_countries,AirPollution,by=c("Country","Year")) %>%
  drop_na() %>% 
  select(c("Country","Year","ForestArea","AirPollution"))
 
```

```{r air-pollution, echo=FALSE}
pps1 <- score_df(data %>% 
                   group_by(Year) %>% 
                   summarise(AirPollution = sum(AirPollution, na.rm = TRUE), 
                             ForestArea = sum(ForestArea)) %>% ungroup() %>% 
                   select(AirPollution, ForestArea))

pps1
```
Findings:

Predictive Power Score of 0 shows no relationship between Forest Area and Air Pollution

## Relation between greenhouse gas emissions and carbon stored in forests

**Analysis and Visualizations of GHG Emissions**

To start with we visualized the top 20 emitters of GHG globally, within the time period 1990-2018. The result below shows China at the top, a country which (as we have already shown) has one of the highest forest area increases between 1990-2020.

```{r top-countries-in-ghg-emissions, message=FALSE}
emissionData%>%
  group_by(country)%>%
  summarise(avgEmission = mean(emissionValue))%>%
  arrange(desc(avgEmission))%>%
  top_n(20)%>%
  ggplot(aes(x=avgEmission, y=reorder(country, avgEmission))) + 
  geom_col(fill="red") + 
  labs(title='Top 20 emitters of GreenHouse gases (1990 - 2018)',
                                 x = 'Average Emissions [1000 tonnes]', y = 'Country')+
  theme(legend.position = "none")+
  scale_x_continuous(labels = scales::comma)
   
```

As seen below, we sought to know the proportionate constituents of the green house gases:

```{r piecharts-for-proportion-of-GHG-gases, results = 'hide'}
mycols <- c("##009999", "#EFC000FF", "#868686FF", "#CD534CFF")
pieData <- emissionData%>%
  group_by(Gas)%>%
  summarise(Value = sum(emissionValue))%>%
  filter(Gas !="All GHG")%>%
  mutate(percentvalue = round(Value / sum(Value)*100), digits=0)%>%
  arrange(percentvalue)

pie <- ggplot(data = pieData, aes(x = "", y = percentvalue, fill = Gas)) +
  geom_col(color='black') +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(percentvalue, "%")), position = position_stack(vjust = 0.5))+
  theme(panel.background = element_blank(),
                    axis.line = element_blank(),
                    axis.text = element_blank(),
                    axis.ticks = element_blank(),
                    axis.title = element_blank(),
                    plot.title = element_text(hjust = 0.5, size = 18))+
  ggtitle("Proportion of GHG gases") 
pie 
```

Furthermore we calculated the average emission per country from 1990 - 2020 which is visualized in the map below.

```{r worldmap, include=FALSE}
dataAggregate <- aggregate(emissionValue ~ country, emissionData, mean)
colnames(dataAggregate)[colnames(dataAggregate) == "emissionValue"] <- "Average Emission Value [MtCO2e] per Country from 1990 to 2020"
worldmaps <- joinCountryData2Map(dataAggregate, nameJoinColumn = "country", joinCode = "NAME", verbose = FALSE)
```

```{r warning=FALSE}
colourPalette <- RColorBrewer::brewer.pal(9, 'Reds')
mapCountryData(worldmaps, 
               nameColumnToPlot = "Average Emission Value [MtCO2e] per Country from 1990 to 2020",
               catMethod = 'fixedWidth', 
               colourPalette = colourPalette, 
               numCats = 50)
```



## Analysis and Visualization of carbon stock 

The next important variable is the carbon stock hold globally, which is here visualized in a trend line for the period 1990-2018. To put it already into relation, we show the visualization for the GHG trend right under it. One can already notice that the carbon stock has especially in the 1990s a sharp decrease, while the GHG trend is increasing strongly since 1999.

```{r merged-data-for-correlation, results = 'hide'}
mergedData <- merge(carbonStockData, emissionData, by=c("country","year"))%>%
  select(c('year', 'country','carbonInTonnes','emissionValue'))%>%
  drop_na()%>%
  group_by(year)%>%
  summarize(carbonStockSum = mean(carbonInTonnes), emissionSum = mean(emissionValue))%>%
  unique()
```

```{r trend-of-carbon-stock, echo=FALSE, results = 'hide'}
mergedData%>%
  ggplot(aes(year, carbonStockSum, group=1)) + geom_line() + 
  geom_point(aes(colour = "red")) + 
  scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+
  scale_y_continuous(labels = scales::comma) + 
  labs(title="Carbon Stock trend from 1990 to 2018", x = "Year", y = "Carbon Stock [1000 tonnes]") +
  theme(legend.position = "none")
```

```{r trend-of-carbon-emitted, echo=FALSE, results = 'hide'}
mergedData%>%
  ggplot(aes(year, emissionSum, group=1)) + geom_line() + 
  geom_point(aes(colour = "red")) + 
  scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+
  scale_y_continuous(labels = scales::comma) + 
  labs(title="Trend of emitted GHG from 1990 to 2018", x = "Year", y = "GHG emitted [1000 tonnes]") +
  theme(legend.position = "none")
  #theme_bw()
```

Before we will calculate the correlation we want first to have a look on the countries with the largest carbon stock. Not surprisingly we find also here countries with the highest number of forest area.

```{r countries-with the-highest-carbon-stock-in-forests, echo=FALSE, message=FALSE}
carbonStockData %>%
  drop_na()%>%
  group_by(country)%>%
  summarise(avgCarbon = mean(carbonInTonnes))%>%
  arrange(desc(avgCarbon))%>%
  top_n(20)%>%
  ggplot(aes(x=avgCarbon, y=reorder(country, avgCarbon))) + geom_col(fill='limegreen') + labs(title='Largest carbon stock in forests (1990 - 2020)', x = 'Average Carbon Stock [1000 tonnes]', y = 'Country') + scale_color_viridis_c(option = "inferno") + theme(legend.position = "none")+scale_x_continuous(labels = scales::comma)
  
```

**Correlation**

We seek to answer the correlation question here, we start by comparing both variables per year.

```{r correlation-plots2, echo=FALSE, message=FALSE}
mergedData%>%
  ggplot(aes(x=emissionSum, y=carbonStockSum)) + geom_point(color="red") +
  labs(x="GHG emissions [1000 tonnes]", y = "Sum of carbon stock in forests [1000 tonnes]", title="GHG emissions against carbon stock in forests, per year") +
  geom_smooth(method = 'lm', fill="darkolivegreen2") +
  scale_y_continuous(labels = scales::comma)
  
```

**Correlation result**

```{r correlation, echo=FALSE}
x <- cor(x=mergedData$emissionSum, y=mergedData$carbonStockSum, use = "everything", method = "kendall")
paste("Kendall = ", x)
```

We decided to use the Kendall method to calculate the correlation, because the data is small and non-normally distributed. We find a very strong negative correlation with -0.95. This results in the interpretation, that a decreasing carbon stock leads to increasing GHG emissions. However, this relationship can not be ascertained using correlation because correlation does not necessarily imply causation.

## Relation between absorbed gas and forest area increase

That’s why we want to put the GHG emission in to relation with the forest area. The objective of our analysis is to investigate how much GHG will be absorbed if the forest area is increased. To do so, we use the carbon stock and forest area datasets already worked on, which we visualize below.

```{r forest-area-against-absorbed-carbon, echo=FALSE, warning=FALSE, message=FALSE}
data <- read_csv("data/fao_fra_datasets/fra_carbon_stock_data.csv", col_types = cols())
forestArea <- read_csv("data/fao_forest_datasets/fao_forest_area_data.csv", col_types = cols())
colnames(forestArea)[colnames(forestArea) == "Area"] <- "country"
colnames(forestArea)[colnames(forestArea) == "Value"] <- "Area"

data <- data %>%
 pivot_longer(c("1990","2000","2010","2015","2016","2017","2018","2019","2020"), names_to = 'Year', values_to = 'carbonStock')%>%
 merge(forestArea, by=c("country","Year"))%>%
 select(c("country","Year","Area","carbonStock"))%>%
 mice(m=5, maxit = 5, seed = 100, printFlag = FALSE)%>%
 complete(2)%>%
 group_by(Year)%>%summarise(totalArea = sum(Area), totalCarbonAbsorbed = sum(carbonStock))
data
```

```{r regression-plots, echo=FALSE, message=FALSE}
df_reg_lines <- expand_grid(intercept = 82:88, slope = seq(0.4, 0.6, 0.1))
data %>%
  ggplot(aes(y = totalArea, x = totalCarbonAbsorbed)) + geom_point(color="red1") + geom_smooth(method = "lm", size = 1, fill="deepskyblue2") + 
  labs(y = "Forest Area [1000 ha]", x = "Carbon Absorbed [MtCO2]", title = "Comparison between absorbed carbon and forest area") +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma)
```

```{r linear-regression, echo=FALSE}
linear_reg() %>%
 set_engine("lm") %>%
 fit(formula = totalCarbonAbsorbed ~ totalArea, data = data) %>%
 tidy()

# TODO: Check these results again on Patricks code
```

Using linear regression we come to the conclusion, that for a 1000 ha increase in total forest area, the volume of carbon absorbed will increase by 0.0025 MtCO2, given that all other variables being constant. Or differently expressed it would lead to a decrease of CO2 by 0.0025 Mt.

## Required forests for Current Co2 emmission

The map below highlights the countries which have to increase the forest area the most to tackle their current CO2 emissions.
As our dataset only provides C02 emission data from 1990-2018, we used the Arima model time series prediction to predict future CO2 emissions. By taking into account that one acre of forest can absorb about 2.5 tons of carbon annually, the predicted CO2 value is used to find the required amount of additional forest area.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ghg<- tibble(read_csv("data/cait_emissions_data.csv")) 

gh1<-ghg%>% filter(Gas=="CO2" & Country!="World") %>% filter(Sector=="Total including LUCF")
colnames(gh1)[1]<-"name"
gh1$code <- countrycode(sourcevar = gh1$name,
                                origin = "country.name",
                                destination = "iso3c")

#function for time series prediction of the future values co2
predic_2021<-function(country){
x<-gh1 %>% filter(name==country) %>% select(-`Data source`,-Sector,-Gas,-Unit,-code) %>% mutate(`1990`=as.double(`1990`)) %>% pivot_longer(cols = -name,names_to = "year",values_to = "emission") %>% arrange(year)
fit<-arima(ts(x$emission,start = 1990,frequency = 1),order = c(1,2,0))
predict(fit,n.ahead=5)$pred[3]
}

ghg_pre<-gh1 %>% rowwise() %>% mutate(new_area=as.numeric(predic_2021(name))/2.5)




div(
  plot_ly(ghg_pre, type='choropleth', locations=ghg_pre$code, z=ghg_pre$new_area, text=ghg_pre$name, colors="Purples", marker = list(line = l)) %>% colorbar(title = "Forest Area <br />Required [1000 ha]") %>% layout(
    title = 'New forest area required <br />to componsate present emission',
    geo = g
  ), align = "right")
```


##  Is there a correlation between available water / precipitation and the amount of forest in a country /  on a continent?

```{r}
aquastat
fa_country_avg <- forest_countries %>% 
  group_by(Country) %>% 
  summarise(ForestArea = mean(ForestArea)) %>% 
  ungroup()

water_forest_data <- inner_join(fa_country_avg, aquastat, by = c("Country" = "Area"))

water_forest_data %>% vis_miss()

# globally
ggplot(water_forest_data, 
       aes(x = `Long-term average annual precipitation in volume`, y = ForestArea)) + 
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  ggrepel::geom_text_repel(
    aes(label = Country), 
    color = "black", size = 7/.pt) +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma)

ggplot(water_forest_data, 
       aes(x = `Long-term average annual precipitation in volume`, y = ForestArea)) + 
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  ggrepel::geom_text_repel(
    aes(label = Country), 
    color = "black", size = 7/.pt) +
  scale_x_continuous(limits = c(0,7500), labels = scales::comma) +
  scale_y_continuous(limits = c(0,400000), labels = scales::comma)

ggplot(water_forest_data, 
       aes(x = `Total renewable water resources`, y = ForestArea)) + 
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  ggrepel::geom_text_repel(
    aes(label = Country), 
    color = "black", size = 7/.pt) +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma)

ggplot(water_forest_data, 
       aes(x = `Total renewable water resources`, y = ForestArea)) + 
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  ggrepel::geom_text_repel(
    aes(label = Country), 
    color = "black", size = 7/.pt) +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma)


shapiro.test(water_forest_data$`Long-term average annual precipitation in volume`)
shapiro.test(water_forest_data$`Total renewable water resources`)
shapiro.test(water_forest_data$ForestArea)

paste("Spearman = ", cor(x = water_forest_data$`Long-term average annual precipitation in volume`, y = water_forest_data$ForestArea, use = "pairwise.complete.obs", method = "spearman")
)

paste("Spearman = ", cor(x = water_forest_data$`Total renewable water resources`, y = water_forest_data$ForestArea, use = "everything", method = "spearman")
)
```


# Final Analysis

Final Analysis
The bottom line on what we've learned from our data is, that forests change incredibly fast. Even in our given time range from the last 30 years we gained many fascinating findings. In general we answered the questions with exploratory data analyses, regression models and correlation. To justify our results, we tried to have a view on our data from at least two sides. In these cases, we were thus able to reinforce a previous result with a further calculation or even visualization (e.g. continental and country-wise results).

Starting with the forest area trends we detected that there are huge differences between countries and even continents when it comes to the development of forest area. While the Americas (in particular South America) and Africa faced a decrease Asian countries could slightly increase the forest area. Main reason for that was the extensive deforestation in Brazil with 19% while China recorded a way higher number in forest area 2020 than in 1990. The forest trend in Europe in the last 30 years is stable, it is even slightly upwards. A new perspective on the world is providing our map with the deforestation analysis. It shows the loss of forests in the past 30 years and furthermore the years until the forests are completely lost, if a country keeps on deforesting with the same pace. However, the numbers should be seen with the understanding that the amount deforestation is declining on almost every continent. For example countries in Americas deforested between 2000-2010 around 7 billion ha, the figure declined between 2010-2020 to 3,1 billion ha. When trying to put the deforestation results into relation with the reforestation we found a moderate correlation, showing that deforestation has actually an impact on reforestation. One could argue that at least some countries want to „make up“ for their human-driven deforestation. Interesting would be also to put the reforestation numbers into relation to other forest destruction causes, to show which countries are willing to tackle climate change. When it comes to natural forest destruction we figured out that wildfires are with 50% share clearly the dominant cause, however it varies between countries, e.g. in Germany is the main cause of forest destruction insects, in Brazil fires. We have to mention here, that our dataset does not distinguish between natural caused and human-driven fires. Based on recent articles and that Brazil is located in a tropical zone, we can assume that it is a human-driven deforestation. That is also one reason why our prediction of when and where wildfires are likely to occur is quite tough to answer. A more precise dataset, distinguishing between the causes of fire is missing. Finally we investigated in another large subject area, forests and the relation to other environmental issues. We were able to calculate the decrease in CO2 (0.0025 MtCO2) if forest area is increased by 1000 ha and furthermore we were able to determine how much forest area each country would have to plant, to be able to absorb their C02 emissions.

Since articles and papers deal very specifically with the individual topics around forests, we wanted to give an overview or a summary with our own data and calculations about the most important issues from the beginning of our project. We are aware that we could not cover everything and would have liked to answer many more questions that came to our mind before or during the project. However, we noticed that this would have been beyond the scope of our project. A look into the future is also intriguing. Besides to observe whether current positive or negative trends are holding on, with more years of collecting data, it would open completely new possibilities to answer further questions and make even more precise predictions.

# Ressources
